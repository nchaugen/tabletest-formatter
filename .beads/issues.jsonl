{"id":"tabletest-formatter-1t5","title":"Implement TableTestFormatterCli command","description":"Implement main CLI command using picocli.\n\n**Package:** io.github.nchaugen.tabletest.formatter.cli\n**Location:** tabletest-formatter-cli/src/main/java/io/github/nchaugen/tabletest/formatter/cli/TableTestFormatterCli.java\n\n**Test:** TableTestFormatterCliTest.java with tests:\n- shouldFormatSingleFile()\n- shouldFormatDirectory()\n- shouldExitZeroWhenCheckModeAndNoChanges()\n- shouldExitOneWhenCheckModeAndChangesNeeded()\n- shouldWriteChangesInApplyMode()\n- shouldNotWriteChangesInCheckMode()\n\n**Implementation:**\n```java\n@Command(\n    name = \"tabletest-format\",\n    description = \"Format TableTest tables in Java/Kotlin/.table files\",\n    mixinStandardHelpOptions = true,\n    version = \"0.1.0-SNAPSHOT\"\n)\npublic class TableTestFormatterCli implements Callable\u003cInteger\u003e {\n    \n    @Parameters(paramLabel = \"PATH\", arity = \"1..*\")\n    private List\u003cPath\u003e paths;\n    \n    @Option(names = {\"-c\", \"--check\"})\n    private boolean checkMode = false;\n    \n    @Option(names = {\"-v\", \"--verbose\"})\n    private boolean verbose = false;\n    \n    @Override\n    public Integer call() {\n        // 1. Discover files using FileDiscovery\n        // 2. Format each file using FileFormatter\n        // 3. Apply changes if not check mode (write to files)\n        // 4. Report results\n        // 5. Return exit code\n    }\n    \n    public static void main(String[] args) {\n        System.exit(new CommandLine(new TableTestFormatterCli()).execute(args));\n    }\n}\n```\n\n**Wire up:**\n- FileDiscovery for finding files\n- FileFormatter for formatting\n- FormattingStatus for aggregating results\n\n**Exit codes:**\n- 0: Success (check: no changes needed, apply: formatting succeeded)\n- 1: Failure (check: changes needed OR errors, apply: errors)\n- 2: Invalid usage (picocli handles)\n\n**File writing (apply mode):**\n- Write formatted content back to files\n- Use atomic write: temp file + move\n- Only write if content changed\n\n**Dependencies:** Requires 8rs (FileDiscovery), 6f7 (FileFormatter), 572 (Result types)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-29T22:12:06.563872+01:00","created_by":"nch","updated_at":"2025-12-29T23:46:54.729201+01:00","closed_at":"2025-12-29T23:46:54.729201+01:00","close_reason":"CLI command implemented and tested successfully","dependencies":[{"issue_id":"tabletest-formatter-1t5","depends_on_id":"tabletest-formatter-8rs","type":"blocks","created_at":"2025-12-29T22:12:18.546456+01:00","created_by":"daemon"},{"issue_id":"tabletest-formatter-1t5","depends_on_id":"tabletest-formatter-572","type":"blocks","created_at":"2025-12-29T22:12:18.583612+01:00","created_by":"daemon"},{"issue_id":"tabletest-formatter-1t5","depends_on_id":"tabletest-formatter-6f7","type":"blocks","created_at":"2025-12-29T22:12:18.620231+01:00","created_by":"daemon"}]}
{"id":"tabletest-formatter-2go","title":"Update all tests for new indentation API","description":"Update all tests to use new IndentType API and remove deprecated method calls.\n\n**Tests already updated (can skip):**\n- TableTestExtractorTest: All tabSize tests removed, now tests preserve tabs/spaces\n- SourceFileFormatterTest: shouldPreserveTabIndentation, shouldPreserveSpaceIndentation updated\n- CLI TabIndentationTest expected file updated\n\n**Tests still using deprecated API (need updating):**\n- TableTestFormatterTest: Many tests call deprecated format(text, indentSize, baseIndent)\n- SourceFileFormatterTest: Other tests may use deprecated format(content, indentSize, tabSize)\n- FileFormatterTest: Uses deprecated API via FileFormatter\n- CliIntegrationTest: All passing, may need updates if CLI API changes\n- TableTestFormatterStepTest: Uses deprecated API via Spotless integration  \n- GradleIntegrationTest: Gradle builds use deprecated API, will work but should update configs\n\n**Key behavior change to verify:**\n- Old: tabs normalized to spaces (tab → 4 spaces + indent)\n- New: tabs preserved (tab → tab + spaces/tabs for indent)\n- Tests expecting normalized output need expected values updated","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-02T22:50:31.836764+01:00","created_by":"nch","updated_at":"2026-01-02T23:36:28.103632+01:00","closed_at":"2026-01-02T23:36:28.103632+01:00","close_reason":"Closed","dependencies":[{"issue_id":"tabletest-formatter-2go","depends_on_id":"tabletest-formatter-dfg","type":"blocks","created_at":"2026-01-02T22:50:43.13191+01:00","created_by":"nch"},{"issue_id":"tabletest-formatter-2go","depends_on_id":"tabletest-formatter-y5d","type":"blocks","created_at":"2026-01-02T22:50:43.168876+01:00","created_by":"nch"}]}
{"id":"tabletest-formatter-2md","title":"Unit tests for TableTestFormatter indentation logic","description":"Add unit tests to TableTestFormatterTest for indentation application:\n\n1. Different indent sizes (0, 2, 4, 8 spaces)\n2. Interaction with base indentation levels\n3. Edge cases:\n   - Empty tables\n   - Single row (header only)\n   - Tables with comments\n   - Tables with blank lines\n\nCurrent state: TableTestFormatter.format(String, int, int) has indentation logic but no dedicated unit tests. Most testing happens via integration tests.\n\nTest approach: Direct calls to formatter.format() with indentSize parameter, verify output has correct indentation spacing.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-01T13:22:39.877875+01:00","created_by":"nch","updated_at":"2026-01-01T15:21:31.393102+01:00","closed_at":"2026-01-01T15:21:31.393102+01:00","close_reason":"Closed"}
{"id":"tabletest-formatter-2pj","title":"Implement TreeSitterJavaExtractor","description":"**Goal:** Add Java tree-sitter support alongside regex (Step 5 of tree-sitter migration)\n\n## Implementation Tasks\n\n1. Add dependency to `tabletest-formatter-core/pom.xml`:\n   ```xml\n   \u003cdependency\u003e\n       \u003cgroupId\u003ech.usi.si.seart\u003c/groupId\u003e\n       \u003cartifactId\u003ejava-tree-sitter\u003c/artifactId\u003e\n       \u003cversion\u003e1.12.0\u003c/version\u003e\n   \u003c/dependency\u003e\n   ```\n\n2. Create `TreeSitterJavaExtractor` implementing `TableTestExtractor` interface\n\n3. Parse Java source with tree-sitter-java\n\n4. Query for `@TableTest` annotations using S-expression query:\n   ```\n   (annotation\n     name: (identifier) @annotation_name\n     arguments: (annotation_argument_list\n       (string_literal) @text_block\n     )\n     (#eq? @annotation_name \"TableTest\")\n   )\n   ```\n\n5. Extract byte ranges:\n   - `tableContentStart/End` - text block content (skip `\"\"\"`)\n   - `baseIndentStart/End` - scan backwards from `@` to line start\n\n6. Return `List\u003cTableMatch\u003e` with byte offsets\n\n7. On parse failure: return empty list (no formatting)\n\n## Critical Tests (⭐ Must Have)\n\nCreate `TreeSitterJavaExtractorTest.java` with:\n\n- ⭐ **Real annotation vs string literal distinction** (main goal!)\n  - Test file with @TableTest in string literal - should NOT extract\n  - Test file with real @TableTest - should extract\n- Multiple @TableTest in one file\n- Nested classes with annotations\n- Parse failures return empty list\n- Base indentation calculation (spaces, tabs, mixed)\n- Text block with various indentation levels\n\n## Acceptance Criteria\n\n- ✅ Dependency added to pom.xml\n- ✅ `TreeSitterJavaExtractor` implements `TableTestExtractor`\n- ✅ All unit tests pass (especially string literal distinction)\n- ✅ Existing code unchanged (parallel implementation)\n- ✅ Returns byte ranges compatible with `TableMatch`\n\n## Files\n\n- `tabletest-formatter-core/pom.xml` - add dependency\n- `TreeSitterJavaExtractor.java` - NEW\n- `TreeSitterJavaExtractorTest.java` - NEW (comprehensive tests)\n\n## Dependencies\n\nDepends on: Migrate TableMatch to byte-range fields issue\n\n## Research References\n\n- Investigation: `PARSER_INVESTIGATION.md`\n- tree-sitter-java docs: https://github.com/tree-sitter/tree-sitter-java\n- java-tree-sitter binding: https://github.com/seart-group/java-tree-sitter","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-03T12:24:02.895281+01:00","created_by":"nch","updated_at":"2026-01-03T21:02:29.631175+01:00","closed_at":"2026-01-03T21:02:29.631175+01:00","close_reason":"SmartTableTestExtractor handles both Java and Kotlin using a state machine parser. No need for tree-sitter extractors.","dependencies":[{"issue_id":"tabletest-formatter-2pj","depends_on_id":"tabletest-formatter-zcx","type":"blocks","created_at":"2026-01-03T12:26:56.133866+01:00","created_by":"nch"},{"issue_id":"tabletest-formatter-2pj","depends_on_id":"tabletest-formatter-swo","type":"blocks","created_at":"2026-01-03T14:58:19.155335+01:00","created_by":"nch"}]}
{"id":"tabletest-formatter-2q3","title":"Add error case tests for malformed table structures","description":"Add tests to TableTestFormatterTest for error cases:\n- Mismatched column counts between rows\n- Tables without header rows\n- Invalid table structure (no pipes, wrong format)\n- Empty input handling\n\nShould validate formatter behavior with invalid input.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-29T21:41:12.109988+01:00","created_by":"nch","updated_at":"2025-12-30T01:10:06.104313+01:00","closed_at":"2025-12-30T01:10:06.104313+01:00","close_reason":"Closed"}
{"id":"tabletest-formatter-3b9","title":"Implement JavaParser-based extraction for Java files","description":"Implement parser-based @TableTest extraction for Java files to correctly distinguish real annotations from string literals.\n\n## Problem\n\nCurrent regex approach treats `@TableTest` in string literals as real annotations:\n- Breaks test fixtures containing sample code\n- Prevents dogfooding (can't format our own test files)\n- Incorrect behavior for any string containing `@TableTest`\n\n## Solution\n\nUse JavaParser 3.27.1 for Java files, keep regex for Kotlin.\n\n## Implementation Plan\n\n1. **Add dependency** to `tabletest-formatter-core/pom.xml`:\n   ```xml\n   \u003cdependency\u003e\n       \u003cgroupId\u003ecom.github.javaparser\u003c/groupId\u003e\n       \u003cartifactId\u003ejavaparser-core\u003c/artifactId\u003e\n       \u003cversion\u003e3.27.1\u003c/version\u003e\n   \u003c/dependency\u003e\n   ```\n\n2. **Create** `JavaParserTableTestExtractor.java`:\n   - Use VoidVisitorAdapter to visit annotations\n   - Extract TextBlockLiteralExpr values\n   - Fallback to regex on parse failure\n\n3. **Update** `SourceFileFormatter.java`:\n   - Dispatch to JavaParser for `.java` files\n   - Keep regex for `.kt` files\n\n4. **Add tests**:\n   - Test string literal vs real annotation distinction\n   - Verify dogfooding works on `TableTestExtractorTest.java`\n\n## Files to Modify\n\n- `tabletest-formatter-core/pom.xml` - add JavaParser dependency\n- `TableTestExtractor.java` - rename to `RegexTableTestExtractor.java`\n- Create `JavaParserTableTestExtractor.java` - new visitor-based extractor\n- `SourceFileFormatter.java` - dispatch based on file extension\n- Tests - add parser-specific test cases\n\n## Trade-offs\n\n**Benefits:**\n- ✅ Fixes dogfooding issue\n- ✅ Correct behavior for all edge cases\n- ✅ Handles complex nesting and multiple parameters\n\n**Costs:**\n- ❌ +1.2MB dependency (JavaParser)\n- ❌ ~10-20x slower parsing (acceptable for formatting)\n- ❌ More complex implementation\n\n## Effort Estimate\n\n~4-7 hours (small-medium task)\n\n## Acceptance Criteria\n\n- [ ] JavaParser dependency added to core POM\n- [ ] JavaParserTableTestExtractor implemented with visitor pattern\n- [ ] File extension-based dispatching in SourceFileFormatter\n- [ ] Tests pass including string literal distinction\n- [ ] Can format tabletest-formatter-core test files without breaking syntax\n- [ ] Regex fallback works for parse failures\n- [ ] Kotlin files still use regex approach\n\n## References\n\n- Investigation: PARSER_INVESTIGATION.md\n- Related issue: tabletest-formatter-5or","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-03T11:01:56.782876+01:00","created_by":"nch","updated_at":"2026-01-03T21:02:02.655486+01:00","closed_at":"2026-01-03T21:02:02.655486+01:00","close_reason":"SmartTableTestExtractor solves the annotation vs string literal problem using a state machine parser. No need for tree-sitter or JavaParser. Regular string syntax support not needed - text blocks are the idiomatic approach."}
{"id":"tabletest-formatter-4eb","title":"Add advanced integration tests with Maven/Gradle","description":"Add comprehensive integration tests using maven-invoker-plugin or gradle-testkit.\n\n## Current State\n\n- **Gradle integration:** Works via addStep() API, tested in GradleIntegrationTest\n- **Maven integration:** Does NOT currently exist (only Gradle + CLI supported)\n- Basic integration-test-project exists demonstrating Gradle usage\n\n## Enhancement: Automated Integration Tests\n\n### Gradle Integration Tests\nExpand existing GradleIntegrationTest (already uses gradle-testkit):\n- Add more scenarios beyond current basic tests\n- Test both Groovy and Kotlin DSL configurations\n- Test error handling and edge cases\n- Test performance with large files\n\n### Maven Integration Tests (Future)\nWould require Maven plugin support first (see issue l8b).\nMaven doesn't have custom formatter support like Gradle does.\n\n## Test Scenarios\n\n1. **Basic formatting:**\n   - Single Java file with @TableTest\n   - Single Kotlin file with @TableTest\n   - Standalone .table file\n\n2. **Complex scenarios:**\n   - Multiple tables in one file\n   - Mixed Java and Kotlin files\n   - Large projects with many tables\n   - Already-formatted files (no changes)\n\n3. **Error handling:**\n   - Malformed tables\n   - Invalid @TableTest syntax\n   - File encoding issues\n\n## Priority\n\nP4 (backlog) - Currently limited to Gradle. Maven support would need l8b first.","status":"open","priority":4,"issue_type":"feature","created_at":"2025-12-29T16:07:13.203118+01:00","created_by":"nch","updated_at":"2026-01-02T21:20:08.190073+01:00"}
{"id":"tabletest-formatter-505","title":"Document Spotless usage in README.md","description":"Add Spotless integration documentation to README.md.\n\nSpotless integration is already implemented in tabletest-formatter-spotless module. Need to document usage.\n\n**Sections to add:**\n1. Maven configuration example\n2. Gradle configuration example  \n3. File types supported (.table, .java, .kt)\n4. How to run (mvn spotless:check, mvn spotless:apply)\n\n**Example Maven config:**\n```xml\n\u003cplugin\u003e\n  \u003cgroupId\u003ecom.diffplug.spotless\u003c/groupId\u003e\n  \u003cartifactId\u003espotless-maven-plugin\u003c/artifactId\u003e\n  \u003cversion\u003e3.1.0\u003c/version\u003e\n  \u003cconfiguration\u003e\n    \u003cformats\u003e\n      \u003cformat\u003e\n        \u003cincludes\u003e\n          \u003cinclude\u003e**/*.table\u003c/include\u003e\n        \u003c/includes\u003e\n        \u003ctabletest /\u003e\n      \u003c/format\u003e\n    \u003c/formats\u003e\n    \u003cjava\u003e\n      \u003ctabletest /\u003e\n    \u003c/java\u003e\n  \u003c/configuration\u003e\n\u003c/plugin\u003e\n```\n\n**Dependencies:** None (Spotless already implemented)","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-29T22:12:07.163994+01:00","created_by":"nch","updated_at":"2025-12-29T22:23:53.291047+01:00","closed_at":"2025-12-29T22:23:53.291047+01:00","close_reason":"Added Gradle Spotless integration documentation to README.md. Maven integration not included as it requires contributing to Spotless project (see yz2)."}
{"id":"tabletest-formatter-572","title":"Implement FormattingResult and FormattingStatus","description":"Implement result types for CLI formatting operations.\n\n**Package:** io.github.nchaugen.tabletest.formatter.cli\n**Location:** tabletest-formatter-cli/src/main/java/io/github/nchaugen/tabletest/formatter/cli/\n\n**Files:**\n- FormattingResult.java (record)\n- FormattingStatus.java (aggregation class)\n\n**Test:** FormattingStatusTest.java with tests:\n- shouldAggregateSuccessfulResults()\n- shouldTrackChangedFiles()\n- shouldTrackErrors()\n\n**API:**\n```java\npublic record FormattingResult(\n    Path file,\n    boolean changed,\n    String formattedContent\n) {}\n\npublic class FormattingStatus {\n    private int filesChecked = 0;\n    private int filesChanged = 0;\n    private List\u003cPath\u003e changedFiles = new ArrayList\u003c\u003e();\n    \n    public void addResult(FormattingResult result)\n    public boolean hasChanges()\n    public int filesChecked()\n    public int filesChanged()\n    public List\u003cPath\u003e changedFiles()\n}\n```","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-29T22:12:06.180966+01:00","created_by":"nch","updated_at":"2025-12-29T22:52:41.63884+01:00","closed_at":"2025-12-29T22:52:41.63884+01:00","close_reason":"Closed"}
{"id":"tabletest-formatter-5or","title":"Upgrade to parser-based @TableTest extraction","description":"Upgrade from regex-based to parser-based @TableTest extraction for robustness.\n\n## Current Limitation\n\nRegex approach has known limitations:\n- May fail on complex nesting\n- Won't handle multiple parameters: `@TableTest(value = \"\"\"...\"\"\", description = \"...\")`\n- Won't distinguish between @TableTest in comments vs actual code\n- Edge cases with string escaping\n\n## Proposed Solution\n\n### Option A: JavaParser + Kotlin Parser\n**Java:** Use JavaParser library to parse AST and find @TableTest annotations\n**Kotlin:** Use kotlinx.ast or Kotlin compiler APIs\n\n**Pros:**\n- Robust - handles all edge cases correctly\n- Can extract exact string literal content\n- Understands language semantics (comments, nesting, etc.)\n\n**Cons:**\n- Additional dependencies\n- More complex implementation\n- Slower performance\n\n### Option B: Leverage Spotless/IDE Parsing\n- Investigate if Spotless already parses Java/Kotlin\n- Hook into existing parsing infrastructure\n- May not be available\n\n## Implementation Strategy\n\n1. Keep existing regex approach as fallback\n2. Add parser-based extraction as primary method\n3. Fall back to regex if parser fails\n4. Comprehensive tests for edge cases\n\n## When to Implement\n\nOnly if regex proves insufficient in real-world usage. Most projects have simple @TableTest usage that regex handles fine.\n\n## Files to Modify\n\n- `TableTestExtractor.java` - add parser-based methods\n- `pom.xml` - add JavaParser/Kotlin parser dependencies\n- Tests - add edge case coverage","status":"closed","priority":4,"issue_type":"feature","created_at":"2025-12-29T16:06:42.383274+01:00","created_by":"nch","updated_at":"2026-01-03T11:02:57.610067+01:00","closed_at":"2026-01-03T11:02:57.610067+01:00","close_reason":"Superseded by tabletest-formatter-3b9 which has concrete implementation plan based on investigation in PARSER_INVESTIGATION.md"}
{"id":"tabletest-formatter-65i","title":"Document CLI usage in README.md","description":"Add CLI usage documentation to README.md.\n\n**Sections to add:**\n1. Installation instructions\n2. Basic usage examples\n3. Command-line options (--check, --verbose)\n4. Exit codes\n5. CI integration examples\n\n**Example content:**\n```bash\n# Format single file\njava -jar tabletest-formatter-cli.jar src/test/java/FooTest.java\n\n# Format directory recursively\njava -jar tabletest-formatter-cli.jar src/\n\n# Check mode (CI)\njava -jar tabletest-formatter-cli.jar --check src/\n```\n\n**Dependencies:** Requires tbd (integration tests) to verify examples work","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-29T22:12:06.961084+01:00","created_by":"nch","updated_at":"2026-01-02T01:02:33.730632+01:00","closed_at":"2026-01-02T01:02:33.730632+01:00","close_reason":"Completed: added comprehensive CLI documentation and configurable indentSize parameter","dependencies":[{"issue_id":"tabletest-formatter-65i","depends_on_id":"tabletest-formatter-apo","type":"blocks","created_at":"2025-12-29T22:12:18.928239+01:00","created_by":"daemon"}]}
{"id":"tabletest-formatter-6f7","title":"Implement FileFormatter for CLI","description":"Implement FileFormatter class to format individual files using TableTestFormatter + TableTestExtractor.\n\n**Package:** io.github.nchaugen.tabletest.formatter.cli\n**Location:** tabletest-formatter-cli/src/main/java/io/github/nchaugen/tabletest/formatter/cli/FileFormatter.java\n\n**Test:** FileFormatterTest.java with tests:\n- shouldFormatStandaloneTableFile()\n- shouldFormatJavaFileWithSingleTable()\n- shouldFormatJavaFileWithMultipleTables()\n- shouldFormatKotlinFile()\n- shouldReturnUnchangedWhenAlreadyFormatted()\n- shouldHandleFileWithNoTables()\n\n**Implementation:**\n- Format .table files: `formatter.format(entireContent)`\n- Format .java/.kt files: Use Spotless pattern (see below)\n- Use TableTestExtractor.findAll() to find @TableTest annotations\n- Offset-aware replacement for multiple tables\n- Return FormattingResult with changed flag\n\n**Source File Formatting Pattern** (from TableTestFormatterFunc.java:69-105):\n```java\nprivate String formatSourceFile(String content) {\n    List\u003cTableMatch\u003e matches = TableTestExtractor.findAll(content);\n    if (matches.isEmpty()) return content;\n\n    StringBuilder result = new StringBuilder(content);\n    int offset = 0;\n\n    for (TableMatch match : matches) {\n        String originalTable = match.originalText();\n        String formattedTable = formatter.format(originalTable);\n\n        if (!formattedTable.equals(originalTable)) {\n            // Find table content positions (after opening \"\"\")\n            String beforeTable = content.substring(match.startIndex(), match.endIndex());\n            int tableContentStart = beforeTable.indexOf(\"\\\"\\\"\\\"\") + 3;\n            int tableContentEnd = beforeTable.lastIndexOf(\"\\\"\\\"\\\"\");\n\n            // Calculate positions with offset\n            int actualStart = match.startIndex() + offset + tableContentStart;\n            int actualEnd = match.startIndex() + offset + tableContentEnd;\n\n            result.replace(actualStart, actualEnd, formattedTable);\n\n            // Update offset for next replacement\n            offset += formattedTable.length() - originalTable.length();\n        }\n    }\n\n    return result.toString();\n}\n```\n\n**Reference:** tabletest-formatter-spotless/src/main/java/io/github/nchaugen/tabletest/formatter/spotless/TableTestFormatterFunc.java","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-29T22:12:06.37436+01:00","created_by":"nch","updated_at":"2025-12-29T23:37:09.39991+01:00","closed_at":"2025-12-29T23:37:09.39991+01:00","close_reason":"Closed"}
{"id":"tabletest-formatter-6n1","title":"Add configuration options for formatting","description":"Add configuration options to customize formatting behavior.\n\n## Potential Configuration Options\n\n### Indentation\n- Indent size (2 vs 4 spaces)\n- Tab vs space indentation\n- Auto-detect from project or explicit configuration\n\n### Spacing\n- Pipe spacing style: ` | ` (current) vs `|` (no spaces)\n- Collection spacing: `, ` vs `,`\n- Configurable via Spotless plugin configuration\n\n### Quote Style\n- Preserve original (current default)\n- Normalize to single quotes\n- Normalize to double quotes\n\n### Column Alignment\n- Align all columns (current)\n- Only align first N columns\n- Minimum column width\n\n## Implementation Approach\n\n### For Spotless\n```xml\n\u003cplugin\u003e\n  \u003cgroupId\u003ecom.diffplug.spotless\u003c/groupId\u003e\n  \u003cartifactId\u003espotless-maven-plugin\u003c/artifactId\u003e\n  \u003cconfiguration\u003e\n    \u003cjava\u003e\n      \u003ctabletest\u003e\n        \u003cindentSize\u003e4\u003c/indentSize\u003e\n        \u003cpipeSpacing\u003etrue\u003c/pipeSpacing\u003e\n        \u003cquoteStyle\u003epreserve\u003c/quoteStyle\u003e\n      \u003c/tabletest\u003e\n    \u003c/java\u003e\n  \u003c/configuration\u003e\n\u003c/plugin\u003e\n```\n\n### For CLI\n```bash\ntabletest-formatter --indent-size=4 --pipe-spacing=true src/\n```\n\n## Files to Modify\n\n- `TableTestFormatterState.java` - hold configuration\n- `TableTestFormatter.java` - accept configuration parameter\n- `TableTestFormatterStep.java` - parse configuration from Spotless\n- CLI main class - parse command-line options\n- Tests for each configuration option\n\n## When to Implement\n\nAfter basic formatting is working and users request customization. Start with sensible defaults.\n\n## Priority\n\nP4 (backlog) - nice to have, not critical for initial release","status":"closed","priority":4,"issue_type":"feature","created_at":"2025-12-29T16:06:54.853899+01:00","created_by":"nch","updated_at":"2026-01-02T01:02:33.734448+01:00","closed_at":"2026-01-02T01:02:33.734448+01:00","close_reason":"Completed: added comprehensive CLI documentation and configurable indentSize parameter"}
{"id":"tabletest-formatter-738","title":"Update TableTestFormatter for new indentation API","description":"Update format() signature to accept baseIndentString (String) and IndentType. Refactor applyIndentation() to concatenate base indent string with indentType.repeat(indentSize).","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-02T22:50:30.367878+01:00","created_by":"nch","updated_at":"2026-01-02T23:13:39.154865+01:00","closed_at":"2026-01-02T23:13:39.154865+01:00","close_reason":"Closed","dependencies":[{"issue_id":"tabletest-formatter-738","depends_on_id":"tabletest-formatter-e4x","type":"blocks","created_at":"2026-01-02T22:50:42.948586+01:00","created_by":"nch"},{"issue_id":"tabletest-formatter-738","depends_on_id":"tabletest-formatter-9y1","type":"blocks","created_at":"2026-01-02T22:50:42.985569+01:00","created_by":"nch"}]}
{"id":"tabletest-formatter-77e","title":"Consider merging Step and Func tests","status":"closed","priority":4,"issue_type":"task","created_at":"2025-12-29T17:10:45.186332+01:00","created_by":"nch","updated_at":"2026-01-02T20:57:42.747879+01:00","closed_at":"2026-01-02T20:57:42.747879+01:00","close_reason":"Decided to keep Step and Func tests separate. Clear separation of concerns: Step tests API/factory layer, Func tests implementation behavior. Even though files are small (11 tests total), the separation provides better organization and maintainability."}
{"id":"tabletest-formatter-7br","title":"Document error handling strategy and exception behavior","description":"Define and document error handling strategy for the formatter.\n\nCurrent state:\n- Exceptions propagate from parser/formatter\n- No documented exception behavior in JavaDoc\n- No clear fail-fast vs graceful degradation policy\n\nTasks:\n1. Document exceptions thrown by public APIs in JavaDoc (@throws)\n2. Define strategy: fail-fast on malformed input vs return original\n3. Consider what exceptions TableParser.parse() can throw\n4. Document TableTestFormatter.format() exception contracts\n5. Add error handling tests (relates to error case test issues)\n\nQuestions to answer:\n- What happens with malformed table input?\n- Should formatter return original text on parse failure?\n- What exceptions can caller expect?\n\nFiles:\n- tabletest-formatter-core/src/main/java/.../TableTestFormatter.java\n- tabletest-formatter-core/src/main/java/.../TableTestExtractor.java\n- tabletest-formatter-spotless/src/main/java/.../TableTestFormatterFunc.java","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-29T21:53:28.160106+01:00","created_by":"nch","updated_at":"2026-01-01T23:41:17.498525+01:00","closed_at":"2026-01-01T23:41:17.498525+01:00","close_reason":"Closed"}
{"id":"tabletest-formatter-7xb","title":"Upgrade tabletest-parser to next published version","description":"Currently using 0.5.9-SNAPSHOT from Maven local. Upgrade to official release when tabletest-parser 0.5.9 is published to Maven Central.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-29T13:47:51.746497+01:00","created_by":"nch","updated_at":"2026-01-01T01:46:42.824618+01:00","closed_at":"2026-01-01T01:46:42.824618+01:00","close_reason":"Closed"}
{"id":"tabletest-formatter-8mq","title":"Calculate column widths based on cell content","description":"Implement logic to calculate the maximum width needed for each column, considering all cells in that column. Must handle unicode characters and emojis correctly.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-27T13:27:47.608266+01:00","created_by":"nch","updated_at":"2025-12-27T14:17:38.273997+01:00","closed_at":"2025-12-27T14:17:38.273997+01:00","close_reason":"Closed","dependencies":[{"issue_id":"tabletest-formatter-8mq","depends_on_id":"tabletest-formatter-h79","type":"blocks","created_at":"2025-12-27T13:28:14.28945+01:00","created_by":"daemon"}]}
{"id":"tabletest-formatter-8rs","title":"Implement FileDiscovery for CLI","description":"Implement FileDiscovery class to find .table/.java/.kt files recursively.\n\n**Package:** io.github.nchaugen.tabletest.formatter.cli\n**Location:** tabletest-formatter-cli/src/main/java/io/github/nchaugen/tabletest/formatter/cli/FileDiscovery.java\n\n**Test:** FileDiscoveryTest.java with tests:\n- shouldDiscoverSingleTableFile()\n- shouldDiscoverJavaAndKotlinFiles()\n- shouldRecursivelyDiscoverFilesInDirectory()\n- shouldFilterUnsupportedExtensions()\n- shouldSortFilesForDeterministicOutput()\n\n**Implementation:**\n- Use Files.walk() for recursive traversal\n- Filter by extensions: .table, .java, .kt\n- Sort for deterministic output\n- Skip common directories: .git, target/, build/\n\n**API:**\n```java\npublic class FileDiscovery {\n    private static final Set\u003cString\u003e SUPPORTED_EXTENSIONS = \n        Set.of(\".table\", \".java\", \".kt\");\n    \n    public List\u003cPath\u003e discover(List\u003cPath\u003e inputPaths) throws IOException\n}\n```","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-29T22:11:33.249002+01:00","created_by":"nch","updated_at":"2025-12-29T22:43:54.499627+01:00","closed_at":"2025-12-29T22:43:54.499627+01:00","close_reason":"Closed"}
{"id":"tabletest-formatter-8xn","title":"Update documentation for new indentation approach","description":"Update documentation to reflect new indentation approach.\n\n**Key documentation changes needed:**\n\n**README.md:**\n- Update Configuration Parameters section:\n  - Change tabSize → indentType (space/tab)\n  - Explain: base indentation from source is preserved (tabs stay tabs)\n  - Additional indentation uses specified indentType\n- Update CLI examples: --tab-size → --indent-type\n- Update Spotless examples: .tabSize(4) → .indentType(IndentType.SPACE)\n- Add migration note: old behavior normalized tabs, new behavior preserves them\n\n**JavaDoc updates:**\n- IndentType: Already has good JavaDoc\n- TableMatch: baseIndentString already documented\n- TableTestFormatter: format() overloads have updated JavaDoc, deprecated method documented\n- SourceFileFormatter: format() overloads have updated JavaDoc, deprecated method documented\n- TableTestExtractor: findAll() updated to mention preservation\n\n**CHANGELOG.md for 0.1.0:**\n- Breaking change: Indentation behavior now preserves tabs instead of normalizing\n- Deprecated: format() methods with tabSize parameter\n- New: IndentType enum for explicit indent type control\n- Migration: Old API still works via deprecated methods, but tabs no longer normalized","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-02T22:50:33.172722+01:00","created_by":"nch","updated_at":"2026-01-02T23:46:57.606419+01:00","closed_at":"2026-01-02T23:46:57.606419+01:00","close_reason":"Closed","dependencies":[{"issue_id":"tabletest-formatter-8xn","depends_on_id":"tabletest-formatter-2go","type":"blocks","created_at":"2026-01-02T22:50:43.204994+01:00","created_by":"nch"}]}
{"id":"tabletest-formatter-9jl","title":"Preserve comments and blank lines","description":"Ensure comment lines (starting with //) and blank lines are preserved exactly as-is, including their indentation.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-27T13:27:49.582096+01:00","created_by":"nch","updated_at":"2025-12-27T22:12:05.491396+01:00","closed_at":"2025-12-27T22:12:05.491396+01:00","close_reason":"Closed","dependencies":[{"issue_id":"tabletest-formatter-9jl","depends_on_id":"tabletest-formatter-sy0","type":"blocks","created_at":"2025-12-27T13:28:15.266889+01:00","created_by":"daemon"}]}
{"id":"tabletest-formatter-9st","title":"Preserve original quote choices","description":"Keep user's original quote style choices: '1' stays '1', \"2\" stays \"2\". Don't change quotes unless necessary for correctness.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-27T13:27:50.311815+01:00","created_by":"nch","updated_at":"2025-12-29T13:45:40.033001+01:00","closed_at":"2025-12-29T13:45:40.033001+01:00","close_reason":"Closed","dependencies":[{"issue_id":"tabletest-formatter-9st","depends_on_id":"tabletest-formatter-sy0","type":"blocks","created_at":"2025-12-27T13:28:15.392141+01:00","created_by":"daemon"}]}
{"id":"tabletest-formatter-9wg","title":"Add EditorConfig support for indentation settings","description":"Support reading indentation settings from .editorconfig files to auto-detect project conventions.\n\n## EditorConfig Properties to Support\n\nKey properties for TableTest formatting:\n- `indent_style` (tab/space) - determines base indentation style\n- `indent_size` - number of spaces per indent level\n- `tab_width` - width of tab character (for mixed tab/space handling)\n\nExample .editorconfig:\n```\n[*.java]\nindent_style = space\nindent_size = 4\ntab_width = 4\n\n[*.kt]\nindent_style = space\nindent_size = 4\n```\n\n## Implementation Approach\n\n1. Add dependency: org.editorconfig:editorconfig-core-java\n2. In CLI: Read .editorconfig before formatting\n3. Use detected values as defaults (CLI flags override if specified)\n4. For Spotless integration: Spotless already handles EditorConfig, may not need separate support\n\n## Benefits\n\n- Automatic project convention detection\n- Consistent with other formatters (Prettier, Black via plugins, IDE formatters)\n- Reduces need for explicit CLI configuration\n- Better integration with existing project tooling\n\n## Industry Context\n\nModern formatters increasingly support EditorConfig:\n- JetBrains IDEs: Native support, EditorConfig overrides IDE settings\n- VS Code: Via editorconfig extension\n- Prettier: Via prettier-plugin-editorconfig\n- Most language formatters can be configured via EditorConfig\n\n## Priority Rationale\n\nP4 (Backlog) - Nice to have but not essential:\n- CLI users can specify flags explicitly\n- Spotless integration likely handles this at build tool level\n- Current defaults (4 spaces) work for most Java/Kotlin projects\n- Lower priority than core formatting features\n\n## Related Issues\n\n- Depends on: beads-vw5 (tab width configurability)","status":"open","priority":4,"issue_type":"feature","created_at":"2026-01-01T22:23:09.09423+01:00","created_by":"nch","updated_at":"2026-01-01T22:23:09.09423+01:00"}
{"id":"tabletest-formatter-9wy","title":"Implement Spotless integration with integration tests","description":"Implement Spotless FormatterStep in tabletest-formatter-spotless module.\n\n## Research Complete ✓\n\n**Key Finding:** Spotless passes **entire file content** to FormatterStep as String with Unix newlines, NOT extracted content.\n\n**FormatterStep API:**\n- Receives: `format(String rawUnix, File file)`\n- Returns: formatted String or null if unchanged\n- Pattern: Factory method with State + Func classes\n- State must be Serializable\n\n## Core Features\n\n- Create FormatterStep that wraps core formatting logic (issue okk)\n- Integrate with Spotless plugin lifecycle\n- Handle both Java/Kotlin file content and .table files\n- Integration tests to verify Spotless integration works (issue a4g)\n\n## Implementation Structure\n\n### Issue Breakdown\n\n1. **ep8:** Shared extraction utilities (TableTestExtractor + TableMatch)\n   - Core module, shared with CLI\n   - Regex-based @TableTest finding\n   \n2. **okk:** Spotless FormatterStep wrapper (this issue's implementation)\n   - TableTestFormatterStep (factory)\n   - TableTestFormatterState (serializable state)\n   - TableTestFormatterFunc (formatting logic)\n\n3. **a4g:** Integration tests\n   - Manual verification with sample projects\n   - Validates end-to-end Spotless integration\n\n## Finding Table Strings - Decision Made\n\n**Approach:** Regex pattern matching via TableTestExtractor (issue ep8)\n\nSpotless passes whole file content, so we must find @TableTest annotations ourselves.\n\n**Pattern:** `@TableTest\\s*\\(\\s*\"\"\"(.*?)\"\"\"\\s*\\)` with Pattern.DOTALL\n\n**Rationale:**\n- Simple, no parser dependencies\n- Fast for common cases\n- Covers 90% of real-world usage (single @TableTest per method)\n- Can upgrade to parser later (issue 5or) if edge cases emerge\n\n**Shared with CLI:** Both CLI and Spotless use same TableTestExtractor from core module.\n\n## File Type Handling\n\n### Standalone .table Files\n- Format entire file as single table\n- No indentation needed\n- Direct: `TableTestFormatter.format(content)`\n\n### Java/Kotlin Files\n- Extract @TableTest annotations using TableTestExtractor\n- Format each table content\n- Replace in original file\n- **Indentation:** Keep existing as-is initially, proper handling in issue tod\n\n## Indentation Requirements\n\n**Critical:** Table content should be **one indent level deeper** than @TableTest annotation.\n\nSee **issue tod** for detailed specifications:\n- Java text block handling\n- Kotlin raw string handling\n- Quote alignment rules\n- Trailing newline requirements\n\n**Phase 1 (This Issue):** Keep existing indentation, defer proper detection to tod\n**Phase 2 (Issue tod):** Implement indentation detection and application\n\n## Implementation Phases\n\n**Phase 1 - Basic Formatting:**\n- Issue ep8: TableTestExtractor + TableMatch\n- Issue okk: Spotless FormatterStep wrapper\n- Format .table files ✓\n- Format tables in Java/Kotlin (basic) ✓\n- No proper indentation yet (defer to tod)\n\n**Phase 2 - Indentation:**\n- Issue tod: Detect and apply proper indentation\n\n**Phase 3 - Future Enhancements:**\n- Issue 5or: Parser-based extraction (if needed)\n- Issue 6n1: Configuration options\n- Issue 4eb: Advanced integration tests\n\n## Dependencies\n\n- **Blocked by:** \n  - okk (Spotless wrapper implementation)\n  - Indirectly: ep8 (okk depends on ep8)\n\n## Related Issues\n\n- py5 (CLI) - uses same TableTestExtractor\n- tod (indentation) - deferred until basic formatting works","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-27T12:51:12.937158+01:00","created_by":"nch","updated_at":"2026-01-01T23:01:18.528164+01:00","closed_at":"2026-01-01T23:01:18.528164+01:00","close_reason":"All Spotless integration work complete: FormatterStep wrapper (okk), CLI runner (py5), and integration tests (a4g) are all implemented and passing. 14 tests verify end-to-end functionality.","labels":["feature"],"dependencies":[{"issue_id":"tabletest-formatter-9wy","depends_on_id":"tabletest-formatter-py5","type":"blocks","created_at":"2025-12-27T12:51:30.803009+01:00","created_by":"daemon"},{"issue_id":"tabletest-formatter-9wy","depends_on_id":"tabletest-formatter-okk","type":"blocks","created_at":"2025-12-29T16:07:23.911411+01:00","created_by":"daemon"}]}
{"id":"tabletest-formatter-9y1","title":"Refactor TableTestExtractor to preserve indentation","description":"Remove tabSize parameter from findAll(). Change calculateBaseIndent() to return String instead of int. Remove tab-to-space conversion logic - capture leading whitespace as-is.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-02T22:50:30.170637+01:00","created_by":"nch","updated_at":"2026-01-02T23:13:39.152891+01:00","closed_at":"2026-01-02T23:13:39.152891+01:00","close_reason":"Closed","dependencies":[{"issue_id":"tabletest-formatter-9y1","depends_on_id":"tabletest-formatter-e4x","type":"blocks","created_at":"2026-01-02T22:50:42.910125+01:00","created_by":"nch"}]}
{"id":"tabletest-formatter-a4g","title":"Add Spotless integration tests","description":"Add integration tests to verify Spotless FormatterStep works end-to-end with real projects.\n\n## Approach\n\nCreate sample test project in `src/test/resources/integration-test-project/`:\n- pom.xml (or build.gradle)\n- Sample Java test file with @TableTest annotations\n- Sample Kotlin test file with @TableTest annotations\n- Sample .table files\n\n## Test Scenarios\n\n1. **Manual verification:**\n   - Run Spotless on sample project\n   - Verify tables are formatted correctly\n   - Verify file structure preserved\n   - Verify multiple tables in one file handled\n\n2. **Automated tests (optional):**\n   - Could use maven-invoker-plugin for Maven integration\n   - Or gradle-testkit for Gradle integration\n   - Verify Spotless applies formatting correctly\n\n## Success Criteria\n\n✅ Sample project formats correctly with Spotless\n✅ .table files formatted\n✅ Java @TableTest annotations formatted\n✅ Kotlin @TableTest annotations formatted\n✅ Already-formatted files show no changes\n✅ Documentation updated with usage examples\n\n## Notes\n\n- Priority P3 since this validates existing functionality\n- Can be done after basic implementation works\n- Helps validate real-world usage\n- Provides examples for documentation","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-29T16:06:16.135509+01:00","created_by":"nch","updated_at":"2025-12-29T17:11:59.374931+01:00","closed_at":"2025-12-29T17:11:59.374931+01:00","close_reason":"Completed: Sample integration-test-project with pom.xml, Java/Kotlin test files, and .table files. Added SpotlessIntegrationTest with 6 tests verifying formatter logic. Full Maven/Gradle integration deferred to yz2/x61.","dependencies":[{"issue_id":"tabletest-formatter-a4g","depends_on_id":"tabletest-formatter-okk","type":"blocks","created_at":"2025-12-29T16:07:23.948432+01:00","created_by":"daemon"}]}
{"id":"tabletest-formatter-a95","title":"Improve regex pattern robustness in TableTestExtractor","description":"Current regex pattern has limitations handling nested parentheses in annotation parameters.\n\nCurrent pattern: @TableTest\\s*\\([^)]*?\\\"\\\"\\\"(.*?)\\\"\\\"\\\"[^)]*?\\)\n\nFails on:\n@TableTest(\n    resource = someMethod(\"file.txt\"),  // Nested parens\n    value = \"\"\"\n        name | age\n    \"\"\"\n)\n\nKnown limitation documented at line 33. May require parser-based approach (JavaParser library) instead of regex for full correctness.\n\nConsider:\n1. Improving regex to handle common nested cases\n2. Switching to JavaParser/PSI-based extraction\n3. Adding heuristics to filter edge cases\n\nRelated to comment detection limitation issue.\n\nFiles: tabletest-formatter-core/src/main/java/.../TableTestExtractor.java","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-29T21:53:27.757599+01:00","created_by":"nch","updated_at":"2026-01-02T21:10:25.581991+01:00","closed_at":"2026-01-02T21:10:25.581991+01:00","close_reason":"Not a real-world issue. The example in the description (method calls in annotation parameters like 'resource = someMethod(\"file.txt\")') is invalid Java/Kotlin - annotation parameters must be compile-time constants. Method calls would not compile. The only nested parentheses would come from nested annotations or class literals, which are uncommon with @TableTest and likely handled correctly by the existing regex."}
{"id":"tabletest-formatter-apo","title":"Add CLI integration tests","description":"Add end-to-end integration tests for CLI.\n\n**Package:** io.github.nchaugen.tabletest.formatter.cli\n**Location:** tabletest-formatter-cli/src/test/java/io/github/nchaugen/tabletest/formatter/cli/CliIntegrationTest.java\n\n**Test data:** src/test/resources/cli-test-data/\n```\ncli-test-data/\n├── unformatted/\n│   ├── SimpleTest.java      (single @TableTest)\n│   ├── MultiTableTest.kt    (multiple @TableTest)\n│   └── data.table           (standalone)\n└── formatted/\n    ├── SimpleTest.java      (expected output)\n    ├── MultiTableTest.kt    (expected output)\n    └── data.table           (expected output)\n```\n\n**Tests:**\n- shouldFormatUnformattedFiles()\n- shouldDetectAlreadyFormattedFiles()\n- shouldHandleMultipleTablesInOneFile()\n- shouldFormatMixedFileTypes()\n- shouldHandleNestedDirectories()\n\n**Approach:**\n```java\n@Test\nvoid shouldFormatUnformattedFiles(@TempDir Path tempDir) {\n    // Copy test data to temp directory\n    // Execute CLI: new CommandLine(new TableTestFormatterCli()).execute(args)\n    // Verify actual file contents match expected\n    // Test both check and apply modes\n}\n```\n\n**Key aspects:**\n- Use @TempDir for isolated file system operations\n- Execute via CommandLine for real CLI execution\n- Verify file contents byte-for-byte\n- Test exit codes\n- Test both check mode and apply mode\n\n**Dependencies:** Requires 1t5 (CLI command)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-29T22:12:06.761617+01:00","created_by":"nch","updated_at":"2025-12-30T00:29:51.837033+01:00","closed_at":"2025-12-30T00:29:51.837033+01:00","close_reason":"Closed","dependencies":[{"issue_id":"tabletest-formatter-apo","depends_on_id":"tabletest-formatter-1t5","type":"blocks","created_at":"2025-12-29T22:12:18.771815+01:00","created_by":"daemon"}]}
{"id":"tabletest-formatter-bm3","title":"Handle nested collections with recursive formatting","description":"Apply spacing rules recursively to nested collections: [a:[1,2],b:[3,4]] → [a: [1, 2], b: [3, 4]]. Handle multiple levels of nesting.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-27T13:27:49.221294+01:00","created_by":"nch","updated_at":"2025-12-27T20:39:18.954855+01:00","closed_at":"2025-12-27T20:39:18.954855+01:00","close_reason":"Recursive formatting already implemented. All format methods call formatCell() recursively, handling arbitrary nesting depth.","dependencies":[{"issue_id":"tabletest-formatter-bm3","depends_on_id":"tabletest-formatter-zno","type":"blocks","created_at":"2025-12-27T13:28:14.957499+01:00","created_by":"daemon"},{"issue_id":"tabletest-formatter-bm3","depends_on_id":"tabletest-formatter-yv2","type":"blocks","created_at":"2025-12-27T13:28:15.020867+01:00","created_by":"daemon"},{"issue_id":"tabletest-formatter-bm3","depends_on_id":"tabletest-formatter-bxi","type":"blocks","created_at":"2025-12-27T13:28:15.084335+01:00","created_by":"daemon"}]}
{"id":"tabletest-formatter-bn7","title":"Implement core TableTest formatter with unit test coverage","description":"Implement the core formatting logic in tabletest-formatter-core module. Parse TableTest tables using tabletest-parser and apply formatting rules. This will be implemented in small, test-driven steps with unit test coverage for each step. The formatter should handle tables in Java files, Kotlin files, and standalone .table files.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-27T12:51:12.490601+01:00","created_by":"nch","updated_at":"2025-12-29T14:42:25.499541+01:00","closed_at":"2025-12-29T14:42:25.499541+01:00","close_reason":"Core formatter implementation complete. All dependencies closed. Indentation handling (tod) postponed until CLI/Spotless runners are implemented.","labels":["feature"],"dependencies":[{"issue_id":"tabletest-formatter-bn7","depends_on_id":"tabletest-formatter-h79","type":"blocks","created_at":"2025-12-27T13:28:00.137977+01:00","created_by":"daemon"},{"issue_id":"tabletest-formatter-bn7","depends_on_id":"tabletest-formatter-8mq","type":"blocks","created_at":"2025-12-27T13:28:00.201139+01:00","created_by":"daemon"},{"issue_id":"tabletest-formatter-bn7","depends_on_id":"tabletest-formatter-sy0","type":"blocks","created_at":"2025-12-27T13:28:00.264537+01:00","created_by":"daemon"},{"issue_id":"tabletest-formatter-bn7","depends_on_id":"tabletest-formatter-zno","type":"blocks","created_at":"2025-12-27T13:28:00.328346+01:00","created_by":"daemon"},{"issue_id":"tabletest-formatter-bn7","depends_on_id":"tabletest-formatter-yv2","type":"blocks","created_at":"2025-12-27T13:28:00.391459+01:00","created_by":"daemon"},{"issue_id":"tabletest-formatter-bn7","depends_on_id":"tabletest-formatter-bxi","type":"blocks","created_at":"2025-12-27T13:28:00.453951+01:00","created_by":"daemon"},{"issue_id":"tabletest-formatter-bn7","depends_on_id":"tabletest-formatter-bm3","type":"blocks","created_at":"2025-12-27T13:28:00.516393+01:00","created_by":"daemon"},{"issue_id":"tabletest-formatter-bn7","depends_on_id":"tabletest-formatter-9jl","type":"blocks","created_at":"2025-12-27T13:28:00.578409+01:00","created_by":"daemon"},{"issue_id":"tabletest-formatter-bn7","depends_on_id":"tabletest-formatter-lc4","type":"blocks","created_at":"2025-12-27T13:28:00.639155+01:00","created_by":"daemon"},{"issue_id":"tabletest-formatter-bn7","depends_on_id":"tabletest-formatter-9st","type":"blocks","created_at":"2025-12-27T13:28:00.700207+01:00","created_by":"daemon"}]}
{"id":"tabletest-formatter-bxi","title":"Normalize spacing in sets","description":"Format set literals to have space after commas: {1,2,3} → {1, 2, 3}. Remove extra spaces inside braces: { [ ] } → {[]}.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-27T13:27:48.871396+01:00","created_by":"nch","updated_at":"2025-12-27T20:36:45.924135+01:00","closed_at":"2025-12-27T20:36:45.924135+01:00","close_reason":"Closed","dependencies":[{"issue_id":"tabletest-formatter-bxi","depends_on_id":"tabletest-formatter-sy0","type":"blocks","created_at":"2025-12-27T13:28:14.774814+01:00","created_by":"daemon"}]}
{"id":"tabletest-formatter-c6r","title":"Refactor position tracking logic in TableTestFormatterFunc","description":"Extract complex position calculation logic in TableTestFormatterFunc.formatSourceFile() (lines 84-99) into pure functions.\n\nCurrent issues:\n- Mixes concerns: finding positions AND applying replacements\n- Complex offset tracking with multiple variables\n- Variable naming could be clearer (actualStart/actualEnd vs startPos/endPos)\n\nRefactoring approach:\n- Extract position calculation to pure function returning ReplacementPosition record\n- Separate concerns: calculate positions, then apply replacements\n- Improve testability and clarity\n\nFiles: tabletest-formatter-spotless/src/main/java/.../TableTestFormatterFunc.java","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-29T21:53:27.385875+01:00","created_by":"nch","updated_at":"2025-12-29T23:46:48.65985+01:00","closed_at":"2025-12-29T23:46:48.65985+01:00","close_reason":"Refactoring completed - TableTestFormatterFunc now cleanly delegates to core formatters without complex position tracking"}
{"id":"tabletest-formatter-dfg","title":"Update CLI to use IndentType","description":"Replace --tab-size option with --indent-type (values: space/tab). Update TableTestFormatterCli and FileFormatter to use new IndentType API.\n\n**Key changes:**\n- FileFormatter.java:92 has TODO comment marking where tabSize is ignored\n- Remove the deprecated format(content, indentSize, tabSize) calls\n- Add --indent-type CLI flag (default: space)\n- Remove --tab-size flag (no longer needed since tabs are preserved)\n- Update FileFormatter to pass IndentType.SPACE or IndentType.TAB based on flag\n\n**Note:** The deprecated API in SourceFileFormatter can stay for backwards compatibility in external usage.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-02T22:50:30.785127+01:00","created_by":"nch","updated_at":"2026-01-02T23:28:25.347724+01:00","closed_at":"2026-01-02T23:28:25.347724+01:00","close_reason":"Closed","dependencies":[{"issue_id":"tabletest-formatter-dfg","depends_on_id":"tabletest-formatter-zmt","type":"blocks","created_at":"2026-01-02T22:50:43.059555+01:00","created_by":"nch"}]}
{"id":"tabletest-formatter-dj7","title":"Alternative: Custom 'just enough' parser for @TableTest extraction","description":"**Context:** Alternative to tree-sitter/JavaParser that avoids both regex limitations and native/heavy dependencies.\n\n## The Idea\n\nBuild a lightweight custom parser that does **just enough** to:\n1. Identify method-level `@TableTest` annotations\n2. Extract text block content and byte positions\n3. Extract base indentation\n4. **Skip** detailed parsing of method bodies (just match braces)\n\nThis is a middle ground between:\n- ❌ Regex (50 lines, unreliable - can't distinguish string literals from code)\n- ❌ Tree-sitter (0 lines, but native dependency + multi-platform complexity)\n- ❌ JavaParser (0 lines, 1.2MB pure Java, but only Java not Kotlin)\n- ✅ **Custom parser (~300-500 lines, pure Java, works for Java \u0026 Kotlin)**\n\n## What It Needs to Parse\n\n### Core Elements (Easy)\n- **Braces** `{ }` - track depth to distinguish class/method scope\n- **Scope tracking** - class level (look for annotations) vs method body (skip)\n\n### String Contexts (Moderate)\n- **Regular strings** `\"...\"` - handle escape sequences `\\\"`\n- **Text blocks** `\"\"\"...\"\"\"` - special quoting rules (Java JEP 378)\n- **Kotlin raw strings** `\"\"\"...\"\"\"` - simpler (no escapes)\n- **Character literals** `'{'` - single quotes with special chars\n\n### Comments (Easy)\n- **Line comments** `// ...` - skip to newline\n- **Block comments** `/* ... */` - skip to `*/`\n\n### Critical Rule: Context Precedence\n```\nComments \u003e Strings \u003e Code\n```\n- In comment: quotes/braces don't matter\n- In string: braces don't matter\n- Only in code: look for annotations\n\n## State Machine Design\n\n```java\nenum State { \n    CLASS_SCOPE,      // Look for @TableTest\n    LINE_COMMENT,     // Skip to newline\n    BLOCK_COMMENT,    // Skip to */\n    STRING_LITERAL,   // Skip to closing \"\n    TEXT_BLOCK,       // Extract content!\n    METHOD_BODY       // Skip, just match braces\n}\n\nint braceDepth = 0;\nState state = CLASS_SCOPE;\n\nfor (int i = 0; i \u003c source.length(); i++) {\n    char c = source.charAt(i);\n    char next = peek(i + 1);\n    \n    // Comment detection takes precedence\n    if (state != IN_STRING \u0026\u0026 c == '/' \u0026\u0026 next == '/') {\n        state = LINE_COMMENT;\n        continue;\n    }\n    \n    switch (state) {\n        case CLASS_SCOPE:\n            if (matches(\"@TableTest\")) {\n                // Look for opening \"\"\"\n                if (findNext(\"\\\"\\\"\\\"\")) {\n                    state = TEXT_BLOCK;\n                    recordStart(i);\n                }\n            }\n            if (c == '{') braceDepth++;\n            if (braceDepth \u003e 0) state = METHOD_BODY;\n            break;\n            \n        case METHOD_BODY:\n            // Just match braces, don't look for annotations\n            if (c == '{') braceDepth++;\n            if (c == '}') {\n                braceDepth--;\n                if (braceDepth == 0) state = CLASS_SCOPE;\n            }\n            break;\n            \n        case TEXT_BLOCK:\n            // Extract until closing \"\"\"\n            if (matches(\"\\\"\\\"\\\"\") \u0026\u0026 !escaped()) {\n                recordEnd(i);\n                extractMatch();\n                state = CLASS_SCOPE;\n            }\n            break;\n    }\n}\n```\n\n## Complexity Estimate\n\n**Total: ~300-500 lines**\n- Main parser loop: ~150 lines\n- Text block extraction logic: ~50 lines\n- Comment/string state handling: ~100 lines\n- Base indentation detection: ~50 lines\n- Edge case handling: ~100 lines\n- Tests: ~500 lines (comprehensive)\n\n## The Tricky Parts\n\n### 1. Text Block Quote Escaping (Java JEP 378)\n\n**Java rules:**\n```java\n// One quote - OK\n\"\"\"\nHe said \"hello\"\n\"\"\"\n\n// Two quotes - OK\n\"\"\"\nQuote: \"\"\n\"\"\"\n\n// Three quotes - needs escape\n\"\"\"\nQuote: \\\"\"\"\n\"\"\"\n```\n\n**Kotlin rules (simpler):**\n```kotlin\n// Raw strings - no escapes\n\"\"\"\nEverything \"works\" as-is\nBut \"\"\" is ALWAYS the end (can't be escaped)\n\"\"\"\n```\n\n### 2. False Positives to Avoid\n\n```java\n// Annotation in line comment - SKIP\n// @TableTest(\"\"\"...\"\"\")\n\n// Annotation in block comment - SKIP\n/* @TableTest(\"\"\"...\"\"\") */\n\n// Annotation in string literal - SKIP (main goal!)\nString code = \"@TableTest(\\\"\\\"\\\"...\\\"\\\"\\\")\";\n\n// Annotation in method body - SKIP\nvoid test() {\n    String fake = \"@TableTest(\\\"\\\"\\\"...\\\"\\\"\\\")\";\n}\n\n// Character literals with special chars\nchar quote = '\"';\nchar brace = '{';\nchar slash = '/';\n```\n\n### 3. Nested Annotations\n\n```java\n@Test\n@Disabled\n@TableTest(\"\"\"\n    x | y\n    \"\"\")\nvoid testMethod() {}\n```\n\nNeed to handle multiple annotations per method.\n\n### 4. Annotation with Multiple Parameters\n\n```java\n@TableTest(\n    resource = \"data.csv\",\n    value = \"\"\"\n        x | y\n        1 | 2\n        \"\"\"\n)\n```\n\nNeed to find the text block among other parameters.\n\n## Implementation Strategy\n\n### Phase 1: Core Parser (Java only)\n1. Implement state machine with comment/string/brace tracking\n2. Detect `@TableTest` at class scope\n3. Extract text block content and byte positions\n4. Extract base indentation\n5. Return `List\u003cTableMatch\u003e`\n\n### Phase 2: Comprehensive Testing\n1. String literal distinction (critical test!)\n2. Annotations in comments\n3. Nested classes\n4. Multiple annotations per method\n5. Text blocks with various quote patterns\n6. Edge cases from regex extractor tests\n\n### Phase 3: Kotlin Support\n1. Adapt for Kotlin syntax differences:\n   - `fun` instead of return type\n   - No semicolons\n   - Different string escaping (raw strings)\n2. Share common logic where possible\n\n### Phase 4: Graceful Degradation\n```java\npublic class SmartTableTestExtractor implements TableTestExtractor {\n    @Override\n    public List\u003cTableMatch\u003e findAll(String sourceCode) {\n        try {\n            return parseWithStateMachine(sourceCode);\n        } catch (Exception e) {\n            // Fallback to regex if parsing fails\n            return new RegexTableTestExtractor().findAll(sourceCode);\n        }\n    }\n}\n```\n\n## Pros \u0026 Cons\n\n### Advantages ✅\n- Pure Java - no native dependencies\n- Works everywhere (all platforms, all architectures)\n- Fast - single pass, ~O(n)\n- Right complexity level - not overengineered\n- **Solves main goal:** distinguishes real annotations from string literals\n- Works for Java AND Kotlin (with minor variations)\n- ~300-500 lines - maintainable\n- No external dependencies (beyond JDK)\n- Can dogfood on our own test files\n- Graceful fallback to regex on parse errors\n\n### Challenges ❌\n- Need to implement carefully (state machine)\n- Text block escape rules are non-trivial\n- Need comprehensive test coverage\n- Need to maintain if Java/Kotlin syntax changes\n- Could miss obscure edge cases (but so could any parser)\n\n## Comparison to Other Approaches\n\n| Approach | Lines of Code | Dependencies | Platforms | Java | Kotlin | Complexity |\n|----------|---------------|--------------|-----------|------|--------|------------|\n| **Regex** | 50 | None | All | ✅ | ✅ | Low (unreliable) |\n| **Custom Parser** | 300-500 | None | All | ✅ | ✅ | Medium |\n| **JavaParser** | 0 | 1.2MB | All | ✅ | ❌ | Low (Java only) |\n| **Tree-sitter** | 0 | Native | Multi-build | ✅ | ✅ | High (infra) |\n\n## Critical Test Cases\n\n```java\n// ⭐ PRIMARY GOAL - String literal distinction\n@Test\nvoid testWithFakeAnnotationInString() {\n    String example = \"\"\"\n        @TableTest(\\\"\"\"\n            x | y\n            \\\"\"\")\n        \"\"\";\n    // Should NOT extract this!\n}\n\n@TableTest(\"\"\"\n    real | data\n    \"\"\")\nvoid actualTest() {}\n// Should extract this!\n```\n\nOther critical tests:\n- Annotations in comments (line and block)\n- Multiple @TableTest in one file\n- Nested classes with annotations\n- Text blocks with escaped quotes\n- Character literals with special chars\n- Method bodies with annotation-like strings\n\n## Decision Factors\n\n**Choose Custom Parser if:**\n- ✅ Want zero dependencies\n- ✅ Want to support both Java and Kotlin\n- ✅ Want to avoid native library complexity\n- ✅ Willing to write ~500 lines of well-tested code\n\n**Choose Tree-sitter if:**\n- ✅ Already solved multi-platform native library problem\n- ✅ Want battle-tested parsing\n- ✅ Need full AST for future features\n\n**Choose JavaParser if:**\n- ✅ Only need Java support (not Kotlin)\n- ✅ OK with 1.2MB dependency\n- ✅ Want mature, maintained parser\n\n## Recommendation\n\n**Prototype the custom parser first:**\n1. Implement core state machine (~200 lines)\n2. Add critical test (string literal distinction)\n3. Measure complexity vs value\n\nIf prototype is clean and tests pass → proceed with full implementation.\nIf prototype gets messy → reconsider tree-sitter with multi-platform build.\n\n## Files to Create\n\n- `SmartTableTestExtractor.java` - main implementation\n- `SmartTableTestExtractorTest.java` - comprehensive tests\n- `ParserState.java` - state machine enum/logic\n\n## References\n\n- Java text blocks: [JEP 378](https://openjdk.org/jeps/378)\n- Kotlin raw strings: [Kotlin docs](https://kotlinlang.org/docs/strings.html)\n- Related: `RegexTableTestExtractor.java` (current baseline)\n- Related: `TreeSitterJavaExtractor.java` (blocked on multi-platform)","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-03T15:22:19.028804+01:00","created_by":"nch","updated_at":"2026-01-03T16:21:14.275207+01:00","closed_at":"2026-01-03T16:21:14.275207+01:00","close_reason":"Closed"}
{"id":"tabletest-formatter-e4x","title":"Create IndentType enum and update TableMatch","description":"Create new IndentType enum (SPACE/TAB) in core module with repeat() method. Update TableMatch record to store baseIndentString (String) instead of baseIndent (int) to preserve actual indentation characters.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-02T22:50:29.958466+01:00","created_by":"nch","updated_at":"2026-01-02T23:13:39.150313+01:00","closed_at":"2026-01-02T23:13:39.150313+01:00","close_reason":"Closed"}
{"id":"tabletest-formatter-ecw","title":"Test dogfooding: format own test files","description":"**Goal:** Verify tree-sitter formatter works on our own test files (Step 8 of tree-sitter migration)\n\n## Verification Tasks\n\n1. Run formatter on `TableTestExtractorTest.java`:\n   - Contains @TableTest inside string literals (test fixtures)\n   - Verify test fixtures are NOT formatted (string literals ignored)\n   - Verify real @TableTest annotations (if any) ARE formatted\n\n2. Run formatter on `DisplayWidthTest.java`:\n   - Verify real @TableTest annotations are formatted correctly\n\n3. Run formatter on `TableTestFormatterTest.java`:\n   - Similar verification\n\n4. Run `mvn clean install` with dogfooding enabled:\n   - Check the exec-maven-plugin configuration we added earlier\n   - Verify it uses tree-sitter extractors\n   - Verify no syntax errors after formatting\n\n## Expected Results\n\n✅ **String literals with @TableTest are ignored** (main success criterion!)\n\nExample from `TableTestExtractorTest.java`:\n```java\n@Test\nvoid shouldExtractFromStringLiteral() {\n    var sourceCode = \"\"\"\n        class Test {\n            @TableTest(\\\"\"\"\n                name | age\n                Alice | 30\n                \\\"\"\")  // ← This should NOT be formatted\n            void test() {}\n        }\n        \"\"\";\n    // Test code...\n}\n```\n\nThe inner `@TableTest` is in a string literal, so:\n- ❌ Old regex: would format it (bug!)\n- ✅ Tree-sitter: ignores it (correct!)\n\n## Acceptance Criteria\n\n- ✅ Can format `TableTestExtractorTest.java` without breaking syntax\n- ✅ Test fixtures (string literals) remain unchanged\n- ✅ Real @TableTest annotations are formatted\n- ✅ Can format `DisplayWidthTest.java` correctly\n- ✅ Can format `TableTestFormatterTest.java` correctly\n- ✅ `mvn clean install` succeeds with dogfooding enabled\n- ✅ All tests still pass after formatting\n\n## Files to Test\n\n- `tabletest-formatter-core/src/test/java/.../TableTestExtractorTest.java`\n- `tabletest-formatter-core/src/test/java/.../DisplayWidthTest.java`\n- `tabletest-formatter-core/src/test/java/.../TableTestFormatterTest.java`\n- Any other test files with @TableTest annotations\n\n## Dependencies\n\nDepends on: Wire up tree-sitter extractors issue\n\n## Success Metric\n\n**The key metric:** Test files with @TableTest in string literals can be formatted without syntax errors or unwanted changes to test fixtures.\n\nThis proves we've solved the original problem: distinguishing real annotations from annotations inside strings.","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-03T12:26:46.851395+01:00","created_by":"nch","updated_at":"2026-01-03T20:54:41.286218+01:00","closed_at":"2026-01-03T20:54:41.286218+01:00","close_reason":"Closed","dependencies":[{"issue_id":"tabletest-formatter-ecw","depends_on_id":"tabletest-formatter-egi","type":"blocks","created_at":"2026-01-03T12:26:56.650085+01:00","created_by":"nch"}]}
{"id":"tabletest-formatter-egi","title":"Wire up SmartTableTestExtractor in SourceFileFormatter","description":"**Goal:** Replace RegexTableTestExtractor with SmartTableTestExtractor (custom state-machine parser)\n\n## What Changed\n\nWe implemented SmartTableTestExtractor as an alternative to tree-sitter extractors:\n- Uses custom state machine to track code context (comments, strings, method scope)\n- Reliably distinguishes real @TableTest annotations from ones in string literals/comments\n- Handles both Java and Kotlin without tree-sitter dependencies\n- Solves the key limitation of regex-based extraction\n\n## Implementation Tasks\n\n1. Update SourceFileFormatter.java:\n   - Line 32: Change `new RegexTableTestExtractor()` to `new SmartTableTestExtractor()`\n   - Update import statement\n\n2. Verify all tests pass:\n   - Core module tests (SmartTableTestExtractorTest, SourceFileFormatterTest)\n   - CLI tests (FileFormatterTest, CliIntegrationTest)\n   - Spotless tests\n\n## Acceptance Criteria\n\n- ✅ SourceFileFormatter uses SmartTableTestExtractor\n- ✅ All core tests pass\n- ✅ All CLI tests pass\n- ✅ All Spotless tests pass\n- ✅ No regression in functionality\n- ✅ Comments and string literals are properly ignored\n\n## Files to Modify\n\n- `tabletest-formatter-core/src/main/java/.../SourceFileFormatter.java` - change extractor\n\n## Testing\n\nBoth FileFormatter (CLI) and TableTestFormatterFunc (Spotless) delegate to SourceFileFormatter, so changing the extractor there updates both integrations automatically.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-03T12:24:16.393505+01:00","created_by":"nch","updated_at":"2026-01-03T18:23:17.003831+01:00","closed_at":"2026-01-03T18:23:17.003831+01:00","close_reason":"Closed"}
{"id":"tabletest-formatter-ep8","title":"Create shared TableTest extraction utilities","description":"Create shared utilities in core module for finding @TableTest annotations in Java/Kotlin source files.\n\n## Components to Create\n\n### TableTestExtractor.java\n- Static method: `List\u003cTableMatch\u003e findAll(String sourceCode)`\n- Regex-based pattern matching for `@TableTest(\"\"\"...\"\"\")`\n- Pattern: `@TableTest\\s*\\(\\s*\"\"\"(.*?)\"\"\"\\s*\\)` with Pattern.DOTALL\n- Returns list of all matches with position info\n\n### TableMatch.java\n- Immutable value object (Java record)\n- Fields:\n  - `String originalText` - raw table text as found\n  - `int startIndex` - position in source file\n  - `int endIndex` - end position in source file\n\n## Implementation Approach\n\n**TDD - Tests First:**\n- shouldExtractSingleTableFromJavaFile()\n- shouldExtractMultipleTablesFromOneFile()\n- shouldHandleNoTables()\n- shouldExtractFromKotlinFile()\n- shouldIgnoreTableTestInComments()\n\n**Regex Pattern:**\nCovers 90% of real cases (single @TableTest per method). Can upgrade to parser-based approach later if edge cases emerge.\n\n**Known Limitations (Acceptable):**\n- May fail on complex nesting\n- Won't handle multiple parameters: `@TableTest(value = \"\"\"...\"\"\", description = \"...\")`\n- Won't distinguish between @TableTest in comments vs actual code\n\n## Why Shared in Core?\n\nBoth CLI (py5) and Spotless (9wy) need identical extraction logic. Single source of truth avoids duplication.\n\n## Files\n\n- `tabletest-formatter-core/src/main/java/io/github/nchaugen/tabletest/formatter/core/TableTestExtractor.java`\n- `tabletest-formatter-core/src/main/java/io/github/nchaugen/tabletest/formatter/core/TableMatch.java`\n- `tabletest-formatter-core/src/test/java/io/github/nchaugen/tabletest/formatter/core/TableTestExtractorTest.java`","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-29T16:05:51.544631+01:00","created_by":"nch","updated_at":"2025-12-29T16:36:05.255003+01:00","closed_at":"2025-12-29T16:36:05.255003+01:00","close_reason":"Closed"}
{"id":"tabletest-formatter-h79","title":"Parse simple table and rebuild without formatting","description":"Establish round-trip capability: parse a simple 2x2 table using tabletest-parser and rebuild it as a string without any formatting changes. This validates we can correctly handle the parse → rebuild cycle.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-27T13:27:47.372944+01:00","created_by":"nch","updated_at":"2025-12-27T13:57:58.827597+01:00","closed_at":"2025-12-27T13:57:58.827597+01:00","close_reason":"Closed"}
{"id":"tabletest-formatter-im2","title":"Support regular string syntax in TableTestExtractor","description":"The extractor currently only matches text block syntax (\"\"\"). It should also support regular string syntax with embedded newlines:\n\n@TableTest(\"name|age\\nAlice|30\\nBob|25\")\n\nThis is valid TableTest syntax and should be extracted. Update the regex pattern in TableTestExtractor to handle both text blocks and regular strings.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-30T01:30:42.29031+01:00","created_by":"nch","updated_at":"2026-01-03T21:02:02.657546+01:00","closed_at":"2026-01-03T21:02:02.657546+01:00","close_reason":"SmartTableTestExtractor solves the annotation vs string literal problem using a state machine parser. No need for tree-sitter or JavaParser. Regular string syntax support not needed - text blocks are the idiomatic approach."}
{"id":"tabletest-formatter-it6","title":"Implement TreeSitterKotlinExtractor","description":"**Goal:** Add Kotlin tree-sitter support alongside regex (Step 6 of tree-sitter migration)\n\n## Implementation Tasks\n\n1. Add dependency to `tabletest-formatter-core/pom.xml`:\n   ```xml\n   \u003cdependency\u003e\n       \u003cgroupId\u003eio.github.tree-sitter\u003c/groupId\u003e\n       \u003cartifactId\u003ektreesitter\u003c/artifactId\u003e\n       \u003cversion\u003e0.24.1\u003c/version\u003e\n   \u003c/dependency\u003e\n   ```\n\n2. Create `TreeSitterKotlinExtractor` implementing `TableTestExtractor` interface\n\n3. Parse Kotlin source with tree-sitter-kotlin\n\n4. Query for `@TableTest` annotations using S-expression query:\n   ```\n   (annotation\n     (simple_identifier) @annotation_name\n     (value_arguments\n       (value_argument (string_literal) @raw_string)\n     )\n     (#eq? @annotation_name \"TableTest\")\n   )\n   ```\n\n5. Extract byte ranges:\n   - `tableContentStart/End` - raw string content (skip `\"\"\"`)\n   - `baseIndentStart/End` - scan backwards from `@` to line start\n\n6. Return `List\u003cTableMatch\u003e` with byte offsets\n\n7. On parse failure: return empty list (no formatting)\n\n## Critical Tests (⭐ Must Have)\n\nCreate `TreeSitterKotlinExtractorTest.java` with:\n\n- ⭐ **Real annotation vs string literal distinction** (main goal!)\n  - Test file with @TableTest in raw string - should NOT extract\n  - Test file with real @TableTest - should extract\n- Multiple @TableTest in one file\n- Nested classes with annotations\n- Parse failures return empty list\n- Raw string handling (simpler than Java text blocks)\n\n## Acceptance Criteria\n\n- ✅ Dependency added to pom.xml\n- ✅ `TreeSitterKotlinExtractor` implements `TableTestExtractor`\n- ✅ All unit tests pass (especially string literal distinction)\n- ✅ Existing code unchanged (parallel implementation)\n- ✅ Returns byte ranges compatible with `TableMatch`\n\n## Files\n\n- `tabletest-formatter-core/pom.xml` - add dependency\n- `TreeSitterKotlinExtractor.java` - NEW\n- `TreeSitterKotlinExtractorTest.java` - NEW (comprehensive tests)\n\n## Dependencies\n\nDepends on: Migrate TableMatch to byte-range fields issue\n\n## Notes\n\nKotlin raw strings are simpler than Java text blocks:\n- No JEP 378 indentation stripping needed\n- Just preserve whitespace as-is\n- TableTestParser handles extra whitespace\n\n## Research References\n\n- Investigation: `PARSER_INVESTIGATION.md`\n- tree-sitter-kotlin docs: https://github.com/fwcd/tree-sitter-kotlin\n- ktreesitter binding: https://github.com/tree-sitter/kotlin-tree-sitter","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-03T12:24:16.134487+01:00","created_by":"nch","updated_at":"2026-01-03T21:02:29.633378+01:00","closed_at":"2026-01-03T21:02:29.633378+01:00","close_reason":"SmartTableTestExtractor handles both Java and Kotlin using a state machine parser. No need for tree-sitter extractors.","dependencies":[{"issue_id":"tabletest-formatter-it6","depends_on_id":"tabletest-formatter-zcx","type":"blocks","created_at":"2026-01-03T12:26:56.292828+01:00","created_by":"nch"}]}
{"id":"tabletest-formatter-iz6","title":"Add error case tests for table extractor","description":"Add tests to TableTestExtractorTest for error cases:\n- Invalid annotation syntax\n- Malformed string literals (unclosed quotes)\n- Non-TableTest annotations\n- Corrupted or incomplete source files\n\nShould validate extractor robustness with invalid input.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-29T21:41:12.489471+01:00","created_by":"nch","updated_at":"2025-12-30T01:28:19.538701+01:00","closed_at":"2025-12-30T01:28:19.538701+01:00","close_reason":"Closed"}
{"id":"tabletest-formatter-kv9","title":"Handle Unicode and emoji width calculation correctly","description":"Implement proper display width calculation for Unicode characters and emojis. CJK characters should count as width 2, emojis should be handled correctly, and combining characters as width 0. Currently using simple String.length() which works for ASCII but not for international text.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-27T14:05:39.875983+01:00","created_by":"nch","updated_at":"2025-12-27T19:50:18.433946+01:00","closed_at":"2025-12-27T19:50:18.433946+01:00","close_reason":"Closed"}
{"id":"tabletest-formatter-l1z","title":"Extract TableTestExtractor interface","description":"**Goal:** Create abstraction without breaking anything (Step 1 of tree-sitter migration)\n\n## Tasks\n\n1. Rename `TableTestExtractor` → `RegexTableTestExtractor`\n2. Create `TableTestExtractor` interface with `findAll(String sourceCode)` method\n3. Make `RegexTableTestExtractor` implement the interface\n4. Update imports throughout codebase (no behavior change)\n\n## Acceptance Criteria\n\n- ✅ `TableTestExtractor` is now an interface\n- ✅ `RegexTableTestExtractor` implements interface, contains regex logic\n- ✅ All tests pass\n- ✅ No compilation errors\n- ✅ No behavior changes\n\n## Files to Modify\n\n- `tabletest-formatter-core/src/main/java/.../TableTestExtractor.java` - rename to RegexTableTestExtractor\n- Create new `TableTestExtractor.java` - interface\n- Update all imports that reference the class\n\n## Checkpoint\n\n✅ All tests pass, no compilation errors, ready for next step","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-03T12:21:59.100673+01:00","created_by":"nch","updated_at":"2026-01-03T13:05:38.561443+01:00","closed_at":"2026-01-03T13:05:38.561443+01:00","close_reason":"Closed"}
{"id":"tabletest-formatter-l8b","title":"Consider submitting PR to Spotless for official Maven plugin support","description":"To enable tabletest-formatter usage in Spotless Maven plugin, we'd need to submit a PR to add it as an official formatter option (see https://raw.githubusercontent.com/diffplug/spotless/refs/heads/main/CONTRIBUTING.md). This would involve: 1) Contributing formatter integration to Spotless repo, 2) Following their contribution guidelines, 3) Maintaining compatibility with Spotless releases. This is low priority (P4/backlog) as users can already use the formatter via Gradle plugin or CLI. Consider this only if there's demand for Maven plugin support.","status":"open","priority":4,"issue_type":"task","created_at":"2025-12-29T21:27:23.44982+01:00","created_by":"nch","updated_at":"2025-12-29T21:27:23.44982+01:00"}
{"id":"tabletest-formatter-lc4","title":"Handle empty cells with proper padding","description":"Format empty cells (||) by padding with spaces to maintain column alignment.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-27T13:27:49.945241+01:00","created_by":"nch","updated_at":"2025-12-27T21:08:11.06156+01:00","closed_at":"2025-12-27T21:08:11.06156+01:00","close_reason":"Empty cells handled correctly. Refactored row formatting to eliminate trailing spaces for empty last columns using pre-padded leading spaces with joining('|').","dependencies":[{"issue_id":"tabletest-formatter-lc4","depends_on_id":"tabletest-formatter-sy0","type":"blocks","created_at":"2025-12-27T13:28:15.329321+01:00","created_by":"daemon"}]}
{"id":"tabletest-formatter-okk","title":"Implement Spotless FormatterStep wrapper","description":"Implement Spotless FormatterStep integration that wraps TableTestFormatter.\n\n## Components to Create\n\n### TableTestFormatterStep.java\n- Factory class following Spotless ReplaceStep pattern\n- Static factory method: `FormatterStep create(String name)`\n- Uses `FormatterStep.createLazy()` or `FormatterStep.create()`\n- Returns configured FormatterStep instance\n\n### TableTestFormatterState.java\n- Implements `Serializable` with `serialVersionUID = 1L`\n- Immutable with final fields\n- May be empty initially (no configuration yet)\n- Holds any configuration for future extensibility\n\n### TableTestFormatterFunc.java\n- Main formatting orchestration logic\n- Implements `FormatterFunc`\n- Method signature: `String apply(String rawUnix, File file)`\n\n**Logic Flow:**\n```\nif file.endsWith(\".table\")\n  → TableTestFormatter.format(rawUnix)\nelse if file.endsWith(\".java\") || file.endsWith(\".kt\")\n  → TableTestExtractor.findAll(rawUnix)\n  → for each match: TableTestFormatter.format(match.originalText)\n  → replace in rawUnix\n  → return modified content (or null if unchanged)\nelse\n  → return rawUnix (unchanged)\n```\n\n## File Type Handling\n\n**Standalone .table files:**\n- Format entire file as single table\n- Direct call: `TableTestFormatter.format(content)`\n\n**Java/Kotlin files:**\n- Extract @TableTest annotations using TableTestExtractor\n- Format each table content\n- Replace in original file\n- Keep existing indentation as-is (proper indentation deferred to issue tod)\n\n## Tests (TDD)\n\n**TableTestFormatterStepTest:**\n- shouldCreateValidFormatterStep()\n\n**TableTestFormatterFuncTest:**\n- shouldFormatStandaloneTableFile()\n- shouldFormatTableInJavaFile()\n- shouldFormatTableInKotlinFile()\n- shouldHandleMultipleTablesInOneFile()\n- shouldReturnNullWhenNoChangesNeeded()\n- shouldIgnoreNonTableTestFiles()\n\n## Files\n\n- `tabletest-formatter-spotless/src/main/java/io/github/nchaugen/tabletest/formatter/spotless/TableTestFormatterStep.java`\n- `tabletest-formatter-spotless/src/main/java/io/github/nchaugen/tabletest/formatter/spotless/TableTestFormatterState.java`\n- `tabletest-formatter-spotless/src/main/java/io/github/nchaugen/tabletest/formatter/spotless/TableTestFormatterFunc.java`\n- `tabletest-formatter-spotless/src/test/java/io/github/nchaugen/tabletest/formatter/spotless/TableTestFormatterStepTest.java`\n- `tabletest-formatter-spotless/src/test/java/io/github/nchaugen/tabletest/formatter/spotless/TableTestFormatterFuncTest.java`","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-29T16:06:06.22974+01:00","created_by":"nch","updated_at":"2025-12-29T16:53:29.918196+01:00","closed_at":"2025-12-29T16:53:29.918196+01:00","close_reason":"Closed","dependencies":[{"issue_id":"tabletest-formatter-okk","depends_on_id":"tabletest-formatter-ep8","type":"blocks","created_at":"2025-12-29T16:07:23.873962+01:00","created_by":"daemon"}]}
{"id":"tabletest-formatter-py5","title":"Implement CLI runner with integration tests","description":"Implement command-line interface in tabletest-formatter-cli module using picocli. \n\n## Core Features\n- File discovery (Java/Kotlin/.table files)\n- Format checking mode (exit code for CI)\n- Format apply mode (write changes)\n- Integration tests to ensure CLI works end-to-end\n\n## Research Findings\n\n**Confirmed:** CLI receives **whole .java/.kt files** (not just table content).\n\n**Solution:** Use shared TableTestExtractor (issue ep8) for finding @TableTest annotations.\n\n## Input Processing\n\nThe formatter must:\n1. Locate @TableTest annotations using TableTestExtractor (from core module)\n2. Extract the table content via TableMatch objects\n3. Format each table with TableTestFormatter\n4. Handle indentation correctly (see issue tod)\n5. Replace the original table with formatted version\n6. Write back the entire file\n\nFor standalone .table files: format the entire file as a single table (no indentation needed).\n\n## Finding Table Strings - Decision Made\n\n**Approach:** Regex pattern matching (issue ep8)\n\nUses pattern: `@TableTest\\s*\\(\\s*\"\"\"(.*?)\"\"\"\\s*\\)` with Pattern.DOTALL\n\n**Rationale:**\n- Simple, no external dependencies\n- Fast for straightforward cases\n- Covers 90% of real-world usage\n- Can upgrade to parser-based extraction later (issue 5or) if needed\n\n**Known Limitations (Acceptable):**\n- May fail on complex nesting or comments with @TableTest\n- Won't handle multiple parameters: `@TableTest(value = \"\"\"...\"\"\", description = \"...\")`\n- Can address with parser-based approach if needed\n\n## Shared Code Strategy\n\n**TableTestExtractor** lives in tabletest-formatter-core module (issue ep8):\n- Both CLI and Spotless use same extraction logic\n- Single source of truth\n- Easy to upgrade regex → parser in one place\n\n## Indentation Requirements\n\n**Critical:** Table content must be positioned **one indent level deeper** than the @TableTest annotation.\n\nSee **issue tod** for detailed indentation specifications including:\n- Java text block handling\n- Kotlin raw string handling  \n- Quote alignment rules\n- Trailing newline requirements\n\nThe CLI implementation must detect:\n- Location of @TableTest annotation\n- Project indentation standard (2 or 4 spaces)\n- Opening quote position (same line vs new line)\n- Apply appropriate indentation to formatted output\n\n## Implementation Priority\n\n1. ~~Basic CLI structure (file discovery, read/write)~~ → Depends on ep8\n2. ~~Format checking mode (compare, exit code)~~ → Depends on ep8\n3. ~~Format apply mode (write changes)~~ → Depends on ep8\n4. **Use TableTestExtractor** from core module (depends on issue ep8)\n5. Indentation handling for Java/Kotlin files (depends on issue tod)\n6. Integration tests\n\n## Dependencies\n\n- **Blocks:** None\n- **Blocked by:** ep8 (shared extraction utilities)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-27T12:51:12.719429+01:00","created_by":"nch","updated_at":"2026-01-01T01:51:13.748457+01:00","closed_at":"2026-01-01T01:51:13.748457+01:00","close_reason":"All CLI functionality implemented and tested: file discovery, format check/apply modes, integration tests covering all file types and scenarios","labels":["feature"],"dependencies":[{"issue_id":"tabletest-formatter-py5","depends_on_id":"tabletest-formatter-bn7","type":"blocks","created_at":"2025-12-27T12:51:30.732046+01:00","created_by":"daemon"},{"issue_id":"tabletest-formatter-py5","depends_on_id":"tabletest-formatter-ep8","type":"blocks","created_at":"2025-12-29T16:07:23.83752+01:00","created_by":"daemon"},{"issue_id":"tabletest-formatter-py5","depends_on_id":"tabletest-formatter-8rs","type":"blocks","created_at":"2025-12-29T22:12:19.080093+01:00","created_by":"daemon"},{"issue_id":"tabletest-formatter-py5","depends_on_id":"tabletest-formatter-572","type":"blocks","created_at":"2025-12-29T22:12:19.115548+01:00","created_by":"daemon"},{"issue_id":"tabletest-formatter-py5","depends_on_id":"tabletest-formatter-6f7","type":"blocks","created_at":"2025-12-29T22:12:19.151844+01:00","created_by":"daemon"},{"issue_id":"tabletest-formatter-py5","depends_on_id":"tabletest-formatter-1t5","type":"blocks","created_at":"2025-12-29T22:12:19.18874+01:00","created_by":"daemon"},{"issue_id":"tabletest-formatter-py5","depends_on_id":"tabletest-formatter-apo","type":"blocks","created_at":"2025-12-29T22:12:19.225458+01:00","created_by":"daemon"}]}
{"id":"tabletest-formatter-rqf","title":"Add defensive validation and nullability documentation","description":"Add input validation and nullability documentation across core classes.\n\nMissing validations:\n- TableTestFormatter.format() doesn't validate empty/null input\n- DisplayWidth.of() handles null but doesn't document it\n- TableTestExtractor.findAll() doesn't handle null source code\n\nOptions:\n1. Add Objects.requireNonNull() precondition checks\n2. Use nullability annotations (JSR-305 or JetBrains)\n3. Document nullability in JavaDoc\n\nRecommend: Combination of annotations + precondition checks for public APIs.\n\nFiles: \n- tabletest-formatter-core/src/main/java/.../TableTestFormatter.java\n- tabletest-formatter-core/src/main/java/.../DisplayWidth.java\n- tabletest-formatter-core/src/main/java/.../TableTestExtractor.java","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-29T21:53:27.568117+01:00","created_by":"nch","updated_at":"2026-01-01T23:12:35.697779+01:00","closed_at":"2026-01-01T23:12:35.697779+01:00","close_reason":"Added defensive validation and nullability documentation: Objects.requireNonNull() precondition checks for null inputs, IllegalArgumentException for negative indentSize/baseIndent, and updated JavaDoc to document null handling. 6 new validation tests added."}
{"id":"tabletest-formatter-s9p","title":"Add unit tests for annotation syntax edge cases","description":"Add unit tests to TableTestExtractorTest for annotation syntax edge cases identified during code review.\n\n## Edge Cases to Test\n\n### 1. Comments Between Annotation and Text Block\n\n**Inline comment:**\n```java\n@TableTest( // inline comment\n    \"\"\"\n    name | age\n    Alice | 30\n    \"\"\"\n)\n```\n\n**Block comment:**\n```java\n@TableTest(/* comment */ \"\"\"\n    name | age\n    Alice | 30\n    \"\"\")\n```\n\nExpected: Should extract successfully (regex supports [^)]* before \"\"\")\n\n### 2. Empty Table Content\n\n```java\n@TableTest(\"\"\"\n    \"\"\")\n```\n\nExpected: Should extract successfully (may fail during parsing, but extraction should work)\n\n### 3. Escape Sequences in Table Content\n\n```java\n@TableTest(\"\"\"\n    name | quote\n    Alice | She said \\\"hello\\\"\n    Bob | Line1\\nLine2\n    \"\"\")\n```\n\nExpected: Should extract with escape sequences preserved\n\n### 4. Fully Qualified Annotation Name (Negative Test)\n\n```java\n@io.github.nchaugen.tabletest.TableTest(\"\"\"\n    name | age\n    Alice | 30\n    \"\"\")\n```\n\nExpected: Should NOT extract (regex only matches @TableTest, not fully qualified names)\nDocument this as a known limitation\n\n### 5. Mixed Line Endings (CRLF vs LF)\n\nTest with Windows-style line endings (\\r\\n) vs Unix-style (\\n)\n\nExpected: Should work with both (Pattern.MULTILINE should handle it)\n\n## Test Organization\n\nAdd tests to TableTestExtractorTest.java:\n- `shouldHandleInlineComments()`\n- `shouldHandleBlockComments()`\n- `shouldHandleEmptyTableContent()`\n- `shouldPreserveEscapeSequences()`\n- `shouldNotMatchFullyQualifiedAnnotation()` (negative test)\n- `shouldHandleMixedLineEndings()`\n\n## Priority Rationale\n\nP3 - These are edge cases that likely work already (based on regex analysis) but should be explicitly documented with tests. Not critical for MVP but good for robustness.\n\n## Related Issues\n\n- Part of test coverage improvements alongside beads-zti (integration tests)","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-01T22:38:02.270996+01:00","created_by":"nch","updated_at":"2026-01-01T22:56:45.134382+01:00","closed_at":"2026-01-01T22:56:45.134382+01:00","close_reason":"Closed"}
{"id":"tabletest-formatter-swo","title":"Research: Multi-platform java-tree-sitter integration options","description":"**Context:** TreeSitterJavaExtractor implementation is complete but blocked by native library architecture mismatch on Apple Silicon.\n\n## Problem\n\njava-tree-sitter 1.12.0 uses JNI with platform-specific native libraries:\n- Published JAR contains only x86_64 binaries\n- Fails on ARM64 (Apple Silicon) with: `UnsatisfiedLinkError: (have 'x86_64', need 'arm64')`\n- Upstream issue: https://github.com/seart-group/java-tree-sitter/issues/101 (open since Dec 2023)\n\n## Why Tree-Sitter?\n\n**Advantages:**\n- ✅ Unified approach for Java AND Kotlin extraction\n- ✅ Correctly distinguishes real annotations from string literals (main goal)\n- ✅ Robust AST-based parsing\n\n**Alternative (JavaParser):**\n- ✅ Pure Java, no native deps, works everywhere\n- ❌ Java only - still need regex fallback for Kotlin\n\n## Multi-Platform Build Research\n\n### Build Process (seart-group/java-tree-sitter)\n\n**Tool:** Maven + Python build.py + Docker\n**Architecture support in build.py:**\n```bash\npython build.py -s Darwin -a arm64    # macOS ARM64\npython build.py -s Darwin -a x86_64   # macOS Intel\npython build.py -s Linux -a x86_64    # Linux\npython build.py -s Windows -a x86_64  # Windows\n```\n\n**Dependencies:**\n- Java 11+\n- Maven 3.9+\n- Python 3.10+\n- Docker 23+ (for Linux cross-compile)\n- C compiler toolchain\n\n**Compilation:**\n1. Compiles tree-sitter C library\n2. Compiles 70+ language grammars\n3. Builds JNI bindings\n4. Packages native libs into JAR\n\n### GitHub Actions Multi-Platform Build\n\n**Feasible approach:**\n- Matrix build on multiple runners (macos-13, macos-14, ubuntu-latest, windows-latest)\n- Each builds native lib for its platform\n- Combine all natives into one multi-platform JAR\n- Store as GitHub Release asset or check into repo\n\n**Workflow complexity:** Medium (50-100 lines YAML)\n\n## Integration Options\n\n### Challenge: LibraryLoader Limitations\n\nThe existing `ch.usi.si.seart.treesitter.LibraryLoader`:\n- ✅ Detects OS (Linux/macOS via Apache Commons)\n- ❌ Does NOT detect architecture (x86_64 vs arm64)\n- ❌ Always looks for single `libjava-tree-sitter.{dylib|so}`\n- ❌ Cannot select from multiple arch variants in one JAR\n\n**Source:** https://github.com/seart-group/java-tree-sitter/blob/master/src/main/java/ch/usi/si/seart/treesitter/LibraryLoader.java\n\n### ⭐ PROVEN SOLUTION: KTreeSitter Approach\n\n**Discovery:** KTreeSitter (Kotlin bindings for tree-sitter) successfully solved this problem!\n\n**Their approach:**\n1. **Unified multi-platform JAR** with all natives bundled:\n   ```\n   lib/linux/aarch64/libktreesitter.so\n   lib/linux/x64/libktreesitter.so\n   lib/macos/aarch64/libktreesitter.dylib  ← Apple Silicon!\n   lib/macos/x64/libktreesitter.dylib\n   lib/windows/x64/ktreesitter.dll\n   ```\n\n2. **Custom NativeUtils loader class** that:\n   - Detects OS via `System.getProperty(\"os.name\")`\n   - Detects architecture via `System.getProperty(\"os.arch\")`\n   - Maps OS: \"windows\" → dll, \"linux\" → so, \"mac\" → dylib\n   - Maps arch: \"amd64\"/\"x86_64\" → x64, \"aarch64\"/\"arm64\" → aarch64\n   - Constructs path: `lib/{os}/{arch}/lib{name}.{ext}`\n   - Extracts matching native library and loads it\n\n3. **Kotlin Multiplatform publishing:**\n   - Main artifact: `io.github.tree-sitter:ktreesitter` (metadata)\n   - JVM artifact: `io.github.tree-sitter:ktreesitter-jvm` (JAR with all natives)\n   - Gradle automatically resolves correct variant\n\n**Verified working:** Downloaded and inspected `ktreesitter-jvm-0.24.1.jar` from Maven Central\n\n**Source:**\n- Maven artifact: https://repo1.maven.org/maven2/io/github/tree-sitter/ktreesitter-jvm/0.24.1/\n- Documentation: https://tree-sitter.github.io/kotlin-tree-sitter/\n\n### Option 1: Custom Loader Wrapper ⭐⭐ (RECOMMENDED - Proven by KTreeSitter)\n\n**Approach:**\n```java\npublic class MultiPlatformTreeSitterLoader {\n    static {\n        String platform = detectPlatform(); // \"darwin-arm64\", \"linux-x86_64\", etc.\n        extractNativeLib(\"/natives/\" + platform + \"/libjava-tree-sitter.*\");\n        LibraryLoader.load(); // Delegates to original\n    }\n    \n    private static String detectPlatform() {\n        String osName = System.getProperty(\"os.name\").toLowerCase();\n        String osArch = System.getProperty(\"os.arch\").toLowerCase();\n        \n        // Map to OS folder name\n        String os = osName.contains(\"windows\") ? \"windows\"\n                  : osName.contains(\"linux\") ? \"linux\"\n                  : osName.contains(\"mac\") ? \"macos\"\n                  : throw new UnsupportedOperationException(\"Unsupported OS: \" + osName);\n        \n        // Map to architecture folder name\n        String arch = osArch.equals(\"amd64\") || osArch.equals(\"x86_64\") ? \"x64\"\n                    : osArch.equals(\"aarch64\") || osArch.equals(\"arm64\") ? \"aarch64\"\n                    : throw new UnsupportedOperationException(\"Unsupported arch: \" + osArch);\n        \n        return os + \"-\" + arch;\n    }\n}\n```\n\n**Bundle strategy:**\n- Build multi-platform JAR via GitHub Actions\n- Organize natives: `natives/{os}-{arch}/libjava-tree-sitter.{ext}`\n- Shade into tabletest-formatter-core using maven-shade-plugin\n- Works for CLI, Spotless, and all consumers\n- ~100-150 lines of loader code (following KTreeSitter pattern)\n\n**Pros:**\n- ✅ **PROVEN APPROACH** - KTreeSitter demonstrates it works in production\n- ✅ Transparent to users\n- ✅ Single artifact works everywhere\n- ✅ Works with Spotless isolated classloaders\n- ✅ Published to Maven Central successfully (KTreeSitter example)\n\n**Cons:**\n- ❌ Custom code to maintain (~150 lines)\n- ❌ Need to rebuild when upstream updates\n- ❌ Need GitHub Actions workflow to build multi-platform JAR\n\n**Implementation effort:** Medium\n- GitHub Actions workflow: ~100 lines YAML\n- Custom loader: ~150 lines Java (can adapt from KTreeSitter)\n- Shading configuration: ~20 lines POM\n\n### Option 2: Platform-Specific Classifiers\n\n**Approach:**\nPublish multiple artifacts:\n- `tabletest-formatter-core-macos-arm64`\n- `tabletest-formatter-core-macos-x86_64`\n- `tabletest-formatter-core-linux-x86_64`\n- etc.\n\nUsers select via dependency:\n```xml\n\u003cdependency\u003e\n    \u003cartifactId\u003etabletest-formatter-core\u003c/artifactId\u003e\n    \u003cclassifier\u003emacos-arm64\u003c/classifier\u003e\n\u003c/dependency\u003e\n```\n\n**Pros:**\n- ✅ No custom loader code\n- ✅ Clear separation\n\n**Cons:**\n- ❌ Users must know their platform\n- ❌ Error-prone\n- ❌ Complicates Spotless usage\n\n### Option 3: Contribute to Upstream\n\n**Approach:**\n- Contribute multi-platform GitHub Actions workflow to seart-group\n- Wait for them to publish official multi-platform releases\n- Use standard Maven dependency\n\n**Pros:**\n- ✅ No maintenance burden\n- ✅ Benefits entire community\n- ✅ Proper solution\n\n**Cons:**\n- ❌ Unknown timeline (issue open since Dec 2023)\n- ❌ Blocks our work until accepted/released\n- ❌ May not be prioritized\n\n### Option 4: Hybrid - JavaParser + Tree-Sitter\n\n**Approach:**\n- Use JavaParser for Java (pure Java, works everywhere)\n- Use tree-sitter for Kotlin only (smaller scope)\n- Graceful fallback if tree-sitter unavailable\n\n**Pros:**\n- ✅ Java works immediately on all platforms\n- ✅ Kotlin gets improved extraction when tree-sitter available\n- ✅ Degrades gracefully\n\n**Cons:**\n- ❌ Two different implementations to maintain\n- ❌ Still need to solve tree-sitter multi-platform for Kotlin\n\n## Files Created (Currently Blocked)\n\n- ✅ `TreeSitterJavaExtractor.java` - Implementation complete\n- ✅ `TreeSitterJavaExtractorTest.java` - Comprehensive tests (28 test cases)\n- ✅ Dependency added to core POM\n- ❌ Tests fail on ARM64 due to native lib mismatch\n\n## Decision Recommendation\n\n**Implement Option 1 (Custom Loader Wrapper) following KTreeSitter's proven pattern:**\n\n1. Create GitHub Actions workflow to build multi-platform java-tree-sitter JAR\n2. Implement MultiPlatformTreeSitterLoader (adapt from KTreeSitter's NativeUtils)\n3. Bundle multi-platform JAR into tabletest-formatter-core via shading\n4. Contribute workflow to upstream as PR (Option 3)\n\n**Rationale:**\n- KTreeSitter proves this works in production with Maven Central\n- Provides immediate solution while contributing upstream\n- Enables both Java AND Kotlin support\n- Single artifact, works transparently for users\n- If upstream accepts our workflow contribution, we can eventually switch to their official multi-platform releases\n\n## Research Questions\n\n1. ✅ **Maintenance commitment:** ~150 lines of loader code + GitHub Actions workflow\n2. ✅ **Kotlin priority:** HIGH - tree-sitter is only viable option for Kotlin\n3. 🔄 **Upstream engagement:** Should contribute workflow as PR\n4. ✅ **Alternative approaches:** KTreeSitter demonstrates the solution\n5. ✅ **Test strategy:** Multi-platform JAR enables testing on any platform\n\n## Next Steps\n\n1. Create GitHub Actions workflow for multi-platform build\n2. Implement MultiPlatformTreeSitterLoader (following KTreeSitter pattern)\n3. Configure maven-shade-plugin to bundle multi-platform JAR\n4. Test on ARM64 and x86_64 platforms\n5. Contribute workflow to seart-group/java-tree-sitter as PR\n\n## References\n\n- Upstream issue: https://github.com/seart-group/java-tree-sitter/issues/101\n- Build script: https://github.com/seart-group/java-tree-sitter/blob/master/build.py\n- LibraryLoader: https://github.com/seart-group/java-tree-sitter/blob/master/src/main/java/ch/usi/si/seart/treesitter/LibraryLoader.java\n- Original investigation: PARSER_INVESTIGATION.md (recommended JavaParser)\n- **KTreeSitter (proven solution):**\n  - Maven artifact: https://repo1.maven.org/maven2/io/github/tree-sitter/ktreesitter-jvm/\n  - Documentation: https://tree-sitter.github.io/kotlin-tree-sitter/\n  - GitHub: https://github.com/tree-sitter/kotlin-tree-sitter","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-03T14:58:09.372266+01:00","created_by":"nch","updated_at":"2026-01-03T21:02:02.653013+01:00","closed_at":"2026-01-03T21:02:02.653013+01:00","close_reason":"SmartTableTestExtractor solves the annotation vs string literal problem using a state machine parser. No need for tree-sitter or JavaParser. Regular string syntax support not needed - text blocks are the idiomatic approach."}
{"id":"tabletest-formatter-sy0","title":"Apply column alignment with proper padding","description":"Use calculated column widths to pad cells with spaces, ensuring all pipes align vertically. Add space padding around pipes: ' | '.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-27T13:27:47.837465+01:00","created_by":"nch","updated_at":"2025-12-27T20:02:19.2405+01:00","closed_at":"2025-12-27T20:02:19.2405+01:00","close_reason":"Closed","dependencies":[{"issue_id":"tabletest-formatter-sy0","depends_on_id":"tabletest-formatter-8mq","type":"blocks","created_at":"2025-12-27T13:28:14.471243+01:00","created_by":"daemon"}]}
{"id":"tabletest-formatter-tod","title":"Handle indentation for embedded tables","description":"Preserve and apply proper indentation when formatting tables embedded in Java/Kotlin files.\n\n## Desired Behaviour (to be implemented after CLI/Spotless runners exist)\n\n### Indentation Rules\n- Table content should be **one indent level deeper** than the `@TableTest` annotation\n- Applies to both Java and Kotlin source files\n- Last table row should end with newline\n- Add sufficient trailing spaces to align closing quotes properly with table content\n\n### Java Text Blocks\n```java\n    @TableTest(\"\"\"\n        name  | age      // one indent from annotation (4 or 2 spaces depending on project)\n        Alice | 30\n        Bob   | 25\n        \"\"\")             // closing quotes aligned with table\n```\n\n### Kotlin Raw Strings\n```kotlin\n    @TableTest(\n        \"\"\"\n        name  | age      // one indent from annotation\n        Alice | 30\n        Bob   | 25\n        \"\"\"              // closing quotes aligned with table\n    )\n```\n\n### Context-Awareness Required\n- **CLI mode**: Receives whole .java/.kt file, needs to:\n  - Detect `@TableTest` annotation position\n  - Determine project's indentation standard (2 or 4 spaces)\n  - Handle Java text block vs Kotlin raw string semantics\n  - Position table one indent deeper than annotation\n  - Align closing quotes with table content\n\n- **Spotless mode**: Unknown how Spotless passes content - investigate first\n\n## Implementation Order\n1. Implement CLI runner (see beads issues for CLI)\n2. Implement Spotless runner (see beads issues for Spotless)\n3. Understand what each runner receives as input\n4. Return to implement this indentation handling with full context\n\n## Open Questions\n- Does Spotless pass whole file or extracted string content?\n- How to detect project indentation standard (2 vs 4 spaces)?\n- Should we handle `.trimIndent()` in Kotlin?\n- How to handle mixed indentation styles in same file?","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-27T13:27:50.676026+01:00","created_by":"nch","updated_at":"2026-01-01T13:25:45.074748+01:00","closed_at":"2026-01-01T13:25:45.074748+01:00","close_reason":"Closed","dependencies":[{"issue_id":"tabletest-formatter-tod","depends_on_id":"tabletest-formatter-sy0","type":"blocks","created_at":"2025-12-27T13:28:15.455523+01:00","created_by":"daemon"},{"issue_id":"tabletest-formatter-tod","depends_on_id":"tabletest-formatter-8mq","type":"blocks","created_at":"2025-12-27T14:05:40.05242+01:00","created_by":"daemon"}]}
{"id":"tabletest-formatter-vat","title":"Extract magic numbers to named constants","description":"Extract magic numbers to named constants for better code clarity.\n\nCurrent issue (TableTestFormatter.java:175):\nint paddingSpaces = width + 1 - DisplayWidth.of(value);\n\nThe '+ 1' accounts for the trailing space in column format but is unclear.\n\nRefactor to:\nprivate static final int COLUMN_SEPARATOR_WIDTH = 1;\nint paddingSpaces = width + COLUMN_SEPARATOR_WIDTH - DisplayWidth.of(value);\n\nSearch for other magic numbers that would benefit from named constants.\n\nFiles: tabletest-formatter-core/src/main/java/.../TableTestFormatter.java","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-29T21:56:32.303392+01:00","created_by":"nch","updated_at":"2026-01-02T20:42:32.468648+01:00","closed_at":"2026-01-02T20:42:32.468648+01:00","close_reason":"Closed"}
{"id":"tabletest-formatter-vgx","title":"Add stress tests for large tables","description":"Add performance/stress tests:\n- Format tables with 1000+ rows\n- Format tables with 50+ columns\n- Format tables with very wide cells (1000+ chars)\n- Validate memory usage remains reasonable\n\nAdd to new LargeTableTest class or existing TableTestFormatterTest.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-29T21:41:12.674916+01:00","created_by":"nch","updated_at":"2026-01-01T23:20:40.982909+01:00","closed_at":"2026-01-01T23:20:40.982909+01:00","close_reason":"Added 5 stress tests in LargeTableTest: 1000 rows, 50 columns, very wide cells (1000+ chars), 100x20 combination, and mixed cell widths. All tests include performance assertions and verify memory-efficient formatting."}
{"id":"tabletest-formatter-vw5","title":"Make tab size configurable (default 4 spaces)","description":"Make tab-to-space conversion configurable instead of hardcoded to 4 spaces.\n\nCurrent implementation:\n- TableTestExtractor.calculateBaseIndent() hardcodes: replaceAll(\"\\t\", \"    \")\n- Tab size is always 4 spaces\n\nProposed change:\n- Add --tab-size CLI option (default: 4)\n- Pass tabSize through formatter chain: CLI → SourceFileFormatter → TableTestExtractor\n- Update calculateBaseIndent(whitespace, tabSize) to use configurable value\n\nBenefits:\n- Support projects using 2-space or 8-space tabs\n- Maintain backward compatibility (default remains 4)\n\n## Industry Research (2026-01-01)\n\nHow other formatters handle tab width:\n- **Black (Python)**: Hardcoded to 4 spaces, not configurable\n- **Prettier (JS/TS)**: Uses tabWidth option (default: 2)\n- **gofmt (Go)**: Uses tabs for indentation, 8-space equivalent for alignment\n- **JetBrains IDEs**: Auto-detect indentation from file or use project settings\n- **VS Code**: editor.tabSize setting (default: 4)\n\nCommon tab width conventions by language/ecosystem:\n- Java/IntelliJ: 4 spaces (our default)\n- Go: 8 spaces\n- JavaScript/Node: 2 spaces\n- Python: 4 spaces (but Black converts all tabs to spaces)\n\nOur normalization strategy (convert tabs to spaces when formatting) aligns with Black and Prettier's approach. Making tab width configurable would primarily benefit Spotless/Maven integration where projects may have different tab width conventions.\n\nPriority: P3 - Lower priority enhancement. Current hardcoded behavior covers most Java/Kotlin use cases.","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-01T13:24:07.825026+01:00","created_by":"nch","updated_at":"2026-01-01T23:58:54.976543+01:00","closed_at":"2026-01-01T23:58:54.976543+01:00","close_reason":"Closed"}
{"id":"tabletest-formatter-x61","title":"Add Gradle integration test with gradle-testkit","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-29T17:10:45.127446+01:00","created_by":"nch","updated_at":"2025-12-29T21:03:28.101858+01:00","closed_at":"2025-12-29T21:03:28.101858+01:00","close_reason":"Completed: Added GradleIntegrationTest with 4 test scenarios using gradle-testkit 8.11.1. Tests verify spotlessApply, spotlessCheck, multiple tables, and Unicode handling. Fixed JUnit platform version conflicts by excluding transitive junit-platform-launcher. Excluded vulnerable testng dependency (CVE VDB-214027). Extracted test dependency versions into properties. Created build.gradle configuration using addStep with TableTestFormatterStep.","dependencies":[{"issue_id":"tabletest-formatter-x61","depends_on_id":"tabletest-formatter-a4g","type":"blocks","created_at":"2025-12-29T17:10:52.758788+01:00","created_by":"daemon"}]}
{"id":"tabletest-formatter-xe3","title":"Unit tests for SourceFileFormatter indentation scenarios","description":"Add unit tests to SourceFileFormatterTest for end-to-end indentation scenarios:\n\n1. Various code style combinations:\n   - Different whitespace around @TableTest annotation\n   - Opening triple-quotes on separate line\n   - Nested class contexts\n\n2. Multiple tables with different indentation levels in same file\n\n3. Mixed indentation scenarios (spaces and tabs in same file)\n\n4. Edge cases:\n   - Deeply nested structures (8+ spaces)\n   - Tables at different nesting levels\n\nCurrent state: One test exists (shouldFormatWithIndentation). Need comprehensive coverage of code style variations.\n\nTest approach: End-to-end tests with full source file content, verify complete formatted output.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-01T13:22:49.572858+01:00","created_by":"nch","updated_at":"2026-01-01T23:03:11.118445+01:00","closed_at":"2026-01-01T23:03:11.118445+01:00","close_reason":"All requested indentation scenarios now covered: code style variations, multiple tables at different indentation levels, mixed spaces/tabs, deeply nested structures, and Kotlin edge cases. 17 comprehensive tests verify end-to-end formatting with indentation."}
{"id":"tabletest-formatter-y5d","title":"Update Spotless integration for IndentType","description":"Update Spotless integration to use IndentType instead of tabSize.\n\n**Key changes:**\n- TableTestFormatterFunc.java:92 has TODO comment marking where tabSize is ignored\n- Remove deprecated format(content, indentSize, tabSize) calls\n- Update factory methods: create(), create(int indentSize), create(int indentSize, IndentType indentType)\n- Update TableTestFormatterState to store IndentType instead of tabSize\n- Update TableTestFormatterFunc to pass IndentType to SourceFileFormatter\n- Update serialVersionUID (since we're changing serialization)\n- Update Gradle configuration examples in tests\n\n**Note:** The deprecated API in SourceFileFormatter provides backwards compatibility during transition.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-02T22:50:30.994064+01:00","created_by":"nch","updated_at":"2026-01-02T23:32:57.493982+01:00","closed_at":"2026-01-02T23:32:57.493982+01:00","close_reason":"Closed","dependencies":[{"issue_id":"tabletest-formatter-y5d","depends_on_id":"tabletest-formatter-zmt","type":"blocks","created_at":"2026-01-02T22:50:43.096187+01:00","created_by":"nch"}]}
{"id":"tabletest-formatter-yjc","title":"Add JavaDoc usage examples to public APIs","description":"Enhance JavaDoc with practical usage examples for key public methods.\n\nAdd examples to:\n- TableTestFormatter.format() - show input/output transformation\n- DisplayWidth.of() - show width calculation for various Unicode\n- TableTestExtractor.findAll() - show source code extraction\n\nExample format:\n/**\n * Formats the given TableTest table text.\n *\n * \u003cp\u003eExample:\n * \u003cpre\u003e\n * var input = \"name|age\\nAlice|30\";\n * var formatted = formatter.format(input);\n * // Returns: \"name  | age\\nAlice | 30\\n\"\n * \u003c/pre\u003e\n *\n * @param tableText the raw table text to format\n * @return the formatted table text\n */\n\nImproves API discoverability and serves as inline documentation.\n\nFiles:\n- tabletest-formatter-core/src/main/java/.../TableTestFormatter.java\n- tabletest-formatter-core/src/main/java/.../DisplayWidth.java\n- tabletest-formatter-core/src/main/java/.../TableTestExtractor.java","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-29T21:53:27.952359+01:00","created_by":"nch","updated_at":"2026-01-02T21:04:21.539005+01:00","closed_at":"2026-01-02T21:04:21.539005+01:00","close_reason":"Closed"}
{"id":"tabletest-formatter-yv2","title":"Normalize spacing in maps","description":"Format map literals to have space after colons and commas: [a:1,b:2] → [a: 1, b: 2].","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-27T13:27:48.514455+01:00","created_by":"nch","updated_at":"2025-12-27T20:36:45.920139+01:00","closed_at":"2025-12-27T20:36:45.920139+01:00","close_reason":"Closed","dependencies":[{"issue_id":"tabletest-formatter-yv2","depends_on_id":"tabletest-formatter-sy0","type":"blocks","created_at":"2025-12-27T13:28:14.710708+01:00","created_by":"daemon"}]}
{"id":"tabletest-formatter-yz2","title":"Add Maven integration test with maven-invoker-plugin","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-29T17:10:45.067772+01:00","created_by":"nch","updated_at":"2025-12-29T21:27:23.227903+01:00","closed_at":"2025-12-29T21:27:23.227903+01:00","close_reason":"Not practical: Spotless Maven plugin requires custom formatters to be officially integrated (see CONTRIBUTING.md). Unlike Gradle plugin which supports programmatic addStep(), Maven plugin needs formatters added to the plugin itself. SpotlessIntegrationTest already validates FormatterStep works correctly. Created new issue for potential future PR to Spotless project.","dependencies":[{"issue_id":"tabletest-formatter-yz2","depends_on_id":"tabletest-formatter-a4g","type":"blocks","created_at":"2025-12-29T17:10:52.721268+01:00","created_by":"daemon"}]}
{"id":"tabletest-formatter-z7k","title":"Add error case tests for quote and Unicode handling","description":"Add tests to TableTestFormatterTest for edge cases:\n- Unmatched quotes (missing closing quote)\n- Invalid Unicode sequences\n- Mixed quote styles within same cell\n- Escaped quotes handling\n\nShould validate proper error handling or graceful degradation.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-29T21:41:12.306072+01:00","created_by":"nch","updated_at":"2025-12-30T01:23:22.524395+01:00","closed_at":"2025-12-30T01:23:22.524395+01:00","close_reason":"Closed"}
{"id":"tabletest-formatter-zcx","title":"Migrate TableMatch to byte-range fields","description":"**Goal:** Add new byte-range fields and migrate code to use them (Steps 2+3+4 of tree-sitter migration)\n\n## Step 2: Add New Fields (Backwards Compatible)\n\nAdd new fields to `TableMatch` alongside existing ones:\n\n```java\npublic record TableMatch(\n    // Old fields (keep temporarily)\n    String originalText,\n    int startIndex,\n    int endIndex,\n    String baseIndentString,\n\n    // New fields (add)\n    int tableContentStart,\n    int tableContentEnd,\n    int baseIndentStart,\n    int baseIndentEnd\n) {}\n```\n\nUpdate `RegexTableTestExtractor` to calculate and populate new fields.\n\n## Step 3: Migrate SourceFileFormatter\n\nUpdate `SourceFileFormatter` to:\n- Extract `originalText` from `content` using `tableContentStart/End`\n- Extract `baseIndentString` from `content` using `baseIndentStart/End`\n- Simplify `replaceTableContent()` - use byte ranges directly (no more searching for `\"\"\"`)\n\n## Step 4: Remove Old Fields (Cleanup)\n\n- Remove `originalText` and `baseIndentString` from `TableMatch`\n- Update `RegexTableTestExtractor` to not calculate them\n- Clean `TableMatch` signature\n\n## Acceptance Criteria\n\n- ✅ Step 2 checkpoint: Both old and new fields populated, all tests pass\n- ✅ Step 3 checkpoint: SourceFileFormatter uses new fields, all tests pass\n- ✅ Step 4 checkpoint: Old fields removed, cleaner API, all tests pass\n- ✅ No compilation errors at any checkpoint\n\n## Files to Modify\n\n- `TableMatch.java` - add new fields, then remove old ones\n- `RegexTableTestExtractor.java` - populate new fields\n- `SourceFileFormatter.java` - extract text from byte ranges\n- Tests - update expectations\n\n## Dependencies\n\nDepends on: Extract TableTestExtractor interface issue","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-03T12:23:09.337498+01:00","created_by":"nch","updated_at":"2026-01-03T13:35:12.578209+01:00","closed_at":"2026-01-03T13:35:12.578209+01:00","close_reason":"Closed","dependencies":[{"issue_id":"tabletest-formatter-zcx","depends_on_id":"tabletest-formatter-l1z","type":"blocks","created_at":"2026-01-03T12:26:55.976316+01:00","created_by":"nch"}]}
{"id":"tabletest-formatter-zmt","title":"Update SourceFileFormatter for IndentType","description":"Remove tabSize parameter, add IndentType parameter. Update calls to TableTestExtractor.findAll() and TableTestFormatter.format() with new signatures. Maintain default overloads.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-02T22:50:30.574253+01:00","created_by":"nch","updated_at":"2026-01-02T23:19:11.335577+01:00","closed_at":"2026-01-02T23:19:11.335577+01:00","close_reason":"Closed","dependencies":[{"issue_id":"tabletest-formatter-zmt","depends_on_id":"tabletest-formatter-738","type":"blocks","created_at":"2026-01-02T22:50:43.0224+01:00","created_by":"nch"}]}
{"id":"tabletest-formatter-zno","title":"Normalize spacing in lists","description":"Format list literals to have space after commas: [1,2,3] → [1, 2, 3]. Remove extra spaces inside brackets: [ [] ] → [[]].","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-27T13:27:48.164153+01:00","created_by":"nch","updated_at":"2025-12-27T20:12:07.199031+01:00","closed_at":"2025-12-27T20:12:07.199031+01:00","close_reason":"List formatting works automatically via Java List.toString(). Parser returns List objects which format correctly with spaces after commas and proper nesting. Added comprehensive tests.","dependencies":[{"issue_id":"tabletest-formatter-zno","depends_on_id":"tabletest-formatter-sy0","type":"blocks","created_at":"2025-12-27T13:28:14.647665+01:00","created_by":"daemon"}]}
{"id":"tabletest-formatter-zti","title":"Integration tests for indentation code style variations","description":"Add comprehensive integration tests covering code style variations for indentation handling:\n\n1. Whitespace variations around annotation:\n   - Space before paren\n   - Space after opening paren\n   - Multiple spaces\n\n2. Opening triple-quote on separate line\n\n3. Different base indentation levels:\n   - 0 spaces (top-level, no indentation)\n   - 2 spaces (shallow)\n   - 8 spaces (deep)\n   - 12+ spaces (very deep)\n\n4. Tab character indentation (base indentation uses tabs)\n\n5. Nested class contexts:\n   - Inner classes with deeper indentation\n   - Multiple nesting levels\n\n6. Mixed scenarios combining above variations\n\nCurrent coverage: Standard 4-space indentation with annotation and quotes on same line\n\nTest approach: Create unformatted/formatted pairs in cli-test-data, add tests to CliIntegrationTest","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-01T12:21:37.871652+01:00","created_by":"nch","updated_at":"2026-01-01T22:45:36.70923+01:00","closed_at":"2026-01-01T22:45:36.70923+01:00","close_reason":"Added 6 comprehensive integration test scenarios covering:\n- Deep indentation (12+ spaces nested classes)\n- Tab-based indentation (tabs normalized to spaces in table content)\n- Shallow indentation (2-space base)\n- Varied whitespace (extra spaces, quotes on separate lines)\n- Named parameter syntax (value = ...)\n- Nested Kotlin classes with multiple indentation levels\n\nAll tests pass successfully."}
