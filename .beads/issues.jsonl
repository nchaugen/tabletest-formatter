{"id":"tabletest-formatter-7xb","title":"Upgrade tabletest-parser to next published version","description":"Currently using 0.5.9-SNAPSHOT from Maven local. Upgrade to official release when tabletest-parser 0.5.9 is published to Maven Central.","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-29T13:47:51.746497+01:00","created_by":"nch","updated_at":"2025-12-29T13:47:51.746497+01:00"}
{"id":"tabletest-formatter-8mq","title":"Calculate column widths based on cell content","description":"Implement logic to calculate the maximum width needed for each column, considering all cells in that column. Must handle unicode characters and emojis correctly.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-27T13:27:47.608266+01:00","created_by":"nch","updated_at":"2025-12-27T14:17:38.273997+01:00","closed_at":"2025-12-27T14:17:38.273997+01:00","close_reason":"Closed","dependencies":[{"issue_id":"tabletest-formatter-8mq","depends_on_id":"tabletest-formatter-h79","type":"blocks","created_at":"2025-12-27T13:28:14.28945+01:00","created_by":"daemon"}]}
{"id":"tabletest-formatter-9jl","title":"Preserve comments and blank lines","description":"Ensure comment lines (starting with //) and blank lines are preserved exactly as-is, including their indentation.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-27T13:27:49.582096+01:00","created_by":"nch","updated_at":"2025-12-27T22:12:05.491396+01:00","closed_at":"2025-12-27T22:12:05.491396+01:00","close_reason":"Closed","dependencies":[{"issue_id":"tabletest-formatter-9jl","depends_on_id":"tabletest-formatter-sy0","type":"blocks","created_at":"2025-12-27T13:28:15.266889+01:00","created_by":"daemon"}]}
{"id":"tabletest-formatter-9st","title":"Preserve original quote choices","description":"Keep user's original quote style choices: '1' stays '1', \"2\" stays \"2\". Don't change quotes unless necessary for correctness.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-27T13:27:50.311815+01:00","created_by":"nch","updated_at":"2025-12-29T13:45:40.033001+01:00","closed_at":"2025-12-29T13:45:40.033001+01:00","close_reason":"Closed","dependencies":[{"issue_id":"tabletest-formatter-9st","depends_on_id":"tabletest-formatter-sy0","type":"blocks","created_at":"2025-12-27T13:28:15.392141+01:00","created_by":"daemon"}]}
{"id":"tabletest-formatter-9wy","title":"Implement Spotless integration with integration tests","description":"Implement Spotless FormatterStep in tabletest-formatter-spotless module.\n\n## Core Features\n- Create FormatterStep that wraps core formatting logic\n- Integrate with Spotless plugin lifecycle\n- Handle both Java/Kotlin file content and .table files\n- Integration tests to verify Spotless integration works correctly\n\n## Input Processing - Research Required\n**Unknown**: What does Spotless pass to our FormatterStep?\n\nOptions:\n1. **Whole file content** (like CLI) - requires finding/extracting @TableTest annotations\n2. **Extracted string literal** - just the table text, possibly with Java text block indentation already processed\n3. **Something else**\n\nAction: Research Spotless FormatterStep API during implementation to understand input format.\n\n## Finding Table Strings - If Spotless Passes Whole Files\n\nIf Spotless passes whole file content (option 1 above), we face the same challenge as CLI:\n\n**Question**: How do we reliably locate @TableTest annotation with table strings?\n\n### Option A: Regex Pattern Matching\n**Pros:** Simple, no external dependencies, fast\n\n**Cons:** Fragile - may fail on:\n- Nested annotations\n- Comments containing @TableTest\n- Multiple @TableTest per file\n- Complex string escaping\n- Annotations with multiple parameters\n\n### Option B: Proper Java/Kotlin Parsing\n**Pros:** Robust, handles all edge cases, understands language semantics\n\n**Cons:** Requires parser dependencies (JavaParser, kotlinx.ast), more complex, slower\n\n### Option C: Leverage Spotless Existing Parsing\n**Investigate**: Does Spotless already parse Java/Kotlin files? Can we hook into that?\n\n**Recommendation**: \n1. First research what Spotless provides\n2. If whole file: check if Spotless exposes parsed AST\n3. If not: use same strategy as CLI (likely regex to start)\n\n## Indentation Requirements\n**Critical**: Table content must be positioned **one indent level deeper** than the @TableTest annotation.\n\nSee **issue tod** for detailed indentation specifications including:\n- Java text block handling\n- Kotlin raw string handling\n- Quote alignment rules\n- Trailing newline requirements\n\nImplementation approach depends on what Spotless provides (see Input Processing above):\n- If whole file: same logic as CLI\n- If extracted content: may need different indentation detection strategy\n\n## Implementation Priority\n1. Research Spotless FormatterStep API\n2. Understand input format (whole file vs extracted content)\n3. Create basic FormatterStep wrapper\n4. Handle .table files (no indentation)\n5. Decide on table finding strategy (if needed)\n6. Handle Java/Kotlin files with proper indentation (see tod)\n7. Integration tests with sample Maven/Gradle projects\n\n## Open Questions (to investigate during implementation)\n- What exactly does Spotless pass to FormatterStep?\n- Does Spotless already parse Java/Kotlin? Can we use that?\n- Does it handle Java text block indentation stripping already?\n- How to extract @TableTest annotations reliably? (if whole file)\n- How to test Spotless integration effectively?\n- Should we support configuration options (indentation size, etc.)?\n\n## Dependencies\nMust implement CLI (py5) first to understand file processing patterns.","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-27T12:51:12.937158+01:00","created_by":"nch","updated_at":"2025-12-29T15:07:05.683286+01:00","labels":["feature"],"dependencies":[{"issue_id":"tabletest-formatter-9wy","depends_on_id":"tabletest-formatter-py5","type":"blocks","created_at":"2025-12-27T12:51:30.803009+01:00","created_by":"daemon"}]}
{"id":"tabletest-formatter-bm3","title":"Handle nested collections with recursive formatting","description":"Apply spacing rules recursively to nested collections: [a:[1,2],b:[3,4]] → [a: [1, 2], b: [3, 4]]. Handle multiple levels of nesting.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-27T13:27:49.221294+01:00","created_by":"nch","updated_at":"2025-12-27T20:39:18.954855+01:00","closed_at":"2025-12-27T20:39:18.954855+01:00","close_reason":"Recursive formatting already implemented. All format methods call formatCell() recursively, handling arbitrary nesting depth.","dependencies":[{"issue_id":"tabletest-formatter-bm3","depends_on_id":"tabletest-formatter-zno","type":"blocks","created_at":"2025-12-27T13:28:14.957499+01:00","created_by":"daemon"},{"issue_id":"tabletest-formatter-bm3","depends_on_id":"tabletest-formatter-yv2","type":"blocks","created_at":"2025-12-27T13:28:15.020867+01:00","created_by":"daemon"},{"issue_id":"tabletest-formatter-bm3","depends_on_id":"tabletest-formatter-bxi","type":"blocks","created_at":"2025-12-27T13:28:15.084335+01:00","created_by":"daemon"}]}
{"id":"tabletest-formatter-bn7","title":"Implement core TableTest formatter with unit test coverage","description":"Implement the core formatting logic in tabletest-formatter-core module. Parse TableTest tables using tabletest-parser and apply formatting rules. This will be implemented in small, test-driven steps with unit test coverage for each step. The formatter should handle tables in Java files, Kotlin files, and standalone .table files.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-27T12:51:12.490601+01:00","created_by":"nch","updated_at":"2025-12-29T14:42:25.499541+01:00","closed_at":"2025-12-29T14:42:25.499541+01:00","close_reason":"Core formatter implementation complete. All dependencies closed. Indentation handling (tod) postponed until CLI/Spotless runners are implemented.","labels":["feature"],"dependencies":[{"issue_id":"tabletest-formatter-bn7","depends_on_id":"tabletest-formatter-h79","type":"blocks","created_at":"2025-12-27T13:28:00.137977+01:00","created_by":"daemon"},{"issue_id":"tabletest-formatter-bn7","depends_on_id":"tabletest-formatter-8mq","type":"blocks","created_at":"2025-12-27T13:28:00.201139+01:00","created_by":"daemon"},{"issue_id":"tabletest-formatter-bn7","depends_on_id":"tabletest-formatter-sy0","type":"blocks","created_at":"2025-12-27T13:28:00.264537+01:00","created_by":"daemon"},{"issue_id":"tabletest-formatter-bn7","depends_on_id":"tabletest-formatter-zno","type":"blocks","created_at":"2025-12-27T13:28:00.328346+01:00","created_by":"daemon"},{"issue_id":"tabletest-formatter-bn7","depends_on_id":"tabletest-formatter-yv2","type":"blocks","created_at":"2025-12-27T13:28:00.391459+01:00","created_by":"daemon"},{"issue_id":"tabletest-formatter-bn7","depends_on_id":"tabletest-formatter-bxi","type":"blocks","created_at":"2025-12-27T13:28:00.453951+01:00","created_by":"daemon"},{"issue_id":"tabletest-formatter-bn7","depends_on_id":"tabletest-formatter-bm3","type":"blocks","created_at":"2025-12-27T13:28:00.516393+01:00","created_by":"daemon"},{"issue_id":"tabletest-formatter-bn7","depends_on_id":"tabletest-formatter-9jl","type":"blocks","created_at":"2025-12-27T13:28:00.578409+01:00","created_by":"daemon"},{"issue_id":"tabletest-formatter-bn7","depends_on_id":"tabletest-formatter-lc4","type":"blocks","created_at":"2025-12-27T13:28:00.639155+01:00","created_by":"daemon"},{"issue_id":"tabletest-formatter-bn7","depends_on_id":"tabletest-formatter-9st","type":"blocks","created_at":"2025-12-27T13:28:00.700207+01:00","created_by":"daemon"}]}
{"id":"tabletest-formatter-bxi","title":"Normalize spacing in sets","description":"Format set literals to have space after commas: {1,2,3} → {1, 2, 3}. Remove extra spaces inside braces: { [ ] } → {[]}.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-27T13:27:48.871396+01:00","created_by":"nch","updated_at":"2025-12-27T20:36:45.924135+01:00","closed_at":"2025-12-27T20:36:45.924135+01:00","close_reason":"Closed","dependencies":[{"issue_id":"tabletest-formatter-bxi","depends_on_id":"tabletest-formatter-sy0","type":"blocks","created_at":"2025-12-27T13:28:14.774814+01:00","created_by":"daemon"}]}
{"id":"tabletest-formatter-h79","title":"Parse simple table and rebuild without formatting","description":"Establish round-trip capability: parse a simple 2x2 table using tabletest-parser and rebuild it as a string without any formatting changes. This validates we can correctly handle the parse → rebuild cycle.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-27T13:27:47.372944+01:00","created_by":"nch","updated_at":"2025-12-27T13:57:58.827597+01:00","closed_at":"2025-12-27T13:57:58.827597+01:00","close_reason":"Closed"}
{"id":"tabletest-formatter-kv9","title":"Handle Unicode and emoji width calculation correctly","description":"Implement proper display width calculation for Unicode characters and emojis. CJK characters should count as width 2, emojis should be handled correctly, and combining characters as width 0. Currently using simple String.length() which works for ASCII but not for international text.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-27T14:05:39.875983+01:00","created_by":"nch","updated_at":"2025-12-27T19:50:18.433946+01:00","closed_at":"2025-12-27T19:50:18.433946+01:00","close_reason":"Closed"}
{"id":"tabletest-formatter-lc4","title":"Handle empty cells with proper padding","description":"Format empty cells (||) by padding with spaces to maintain column alignment.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-27T13:27:49.945241+01:00","created_by":"nch","updated_at":"2025-12-27T21:08:11.06156+01:00","closed_at":"2025-12-27T21:08:11.06156+01:00","close_reason":"Empty cells handled correctly. Refactored row formatting to eliminate trailing spaces for empty last columns using pre-padded leading spaces with joining('|').","dependencies":[{"issue_id":"tabletest-formatter-lc4","depends_on_id":"tabletest-formatter-sy0","type":"blocks","created_at":"2025-12-27T13:28:15.329321+01:00","created_by":"daemon"}]}
{"id":"tabletest-formatter-py5","title":"Implement CLI runner with integration tests","description":"Implement command-line interface in tabletest-formatter-cli module using picocli. \n\n## Core Features\n- File discovery (Java/Kotlin/.table files)\n- Format checking mode (exit code for CI)\n- Format apply mode (write changes)\n- Integration tests to ensure CLI works end-to-end\n\n## Input Processing\nCLI receives **whole .java/.kt files** (not just table content). The formatter must:\n1. Locate @TableTest annotations in the file\n2. Extract the table content\n3. Format the table according to rules\n4. Handle indentation correctly (see Indentation Requirements below)\n5. Replace the original table with formatted version\n6. Write back the entire file\n\nFor standalone .table files: format the entire file as a single table (no indentation needed).\n\n## Finding Table Strings - Critical Decision\n\n**Question**: How do we reliably locate @TableTest annotation with table strings in Java/Kotlin source files?\n\n### Option A: Regex Pattern Matching\n**Pros:**\n- Simple, no external dependencies\n- Fast for straightforward cases\n\n**Cons:**\n- Fragile - may fail on edge cases:\n  - Nested annotations\n  - Comments containing @TableTest\n  - Multiple @TableTest annotations in one file\n  - Complex string escaping\n  - Annotations with multiple parameters\n\n### Option B: Proper Java/Kotlin Parsing\n**Pros:**\n- Robust - handles all edge cases correctly\n- Can extract exact string literal content\n- Understands language semantics (comments, nesting, etc.)\n\n**Cons:**\n- Requires parser dependencies:\n  - Java: JavaParser library or similar\n  - Kotlin: kotlinx.ast or Kotlin compiler APIs\n- More complex implementation\n- Slower performance\n\n### Option C: Hybrid Approach\n- Start with regex for simple cases (single @TableTest per file)\n- Add parser-based fallback if regex is ambiguous\n- Balance simplicity and robustness\n\n**Recommendation**: Research during implementation. Consider:\n1. What are common use patterns? (multiple @TableTest per file?)\n2. Performance requirements\n3. Maintenance burden of parser dependencies\n4. Can we leverage existing Spotless parsing for Java/Kotlin?\n\n**Action**: Start with regex, add parsing if needed.\n\n## Indentation Requirements\n**Critical**: Table content must be positioned **one indent level deeper** than the @TableTest annotation.\n\nSee **issue tod** for detailed indentation specifications including:\n- Java text block handling\n- Kotlin raw string handling  \n- Quote alignment rules\n- Trailing newline requirements\n\nThe CLI implementation must detect:\n- Location of @TableTest annotation\n- Project indentation standard (2 or 4 spaces)\n- Opening quote position (same line vs new line)\n- Apply appropriate indentation to formatted output\n\n## Implementation Priority\n1. Basic CLI structure (file discovery, read/write)\n2. Format checking mode (compare, exit code)\n3. Format apply mode (write changes)\n4. Table string extraction (research regex vs parsing approach)\n5. Indentation handling for Java/Kotlin files (requires research - see tod)\n6. Integration tests\n\n## Open Questions (to investigate during implementation)\n- How to detect @TableTest annotations reliably? (regex vs parsing)\n- How to extract table content while preserving file structure?\n- How to detect project indentation standard?\n- Should we handle multiple @TableTest annotations per file?","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-27T12:51:12.719429+01:00","created_by":"nch","updated_at":"2025-12-29T15:06:45.528398+01:00","labels":["feature"],"dependencies":[{"issue_id":"tabletest-formatter-py5","depends_on_id":"tabletest-formatter-bn7","type":"blocks","created_at":"2025-12-27T12:51:30.732046+01:00","created_by":"daemon"}]}
{"id":"tabletest-formatter-sy0","title":"Apply column alignment with proper padding","description":"Use calculated column widths to pad cells with spaces, ensuring all pipes align vertically. Add space padding around pipes: ' | '.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-27T13:27:47.837465+01:00","created_by":"nch","updated_at":"2025-12-27T20:02:19.2405+01:00","closed_at":"2025-12-27T20:02:19.2405+01:00","close_reason":"Closed","dependencies":[{"issue_id":"tabletest-formatter-sy0","depends_on_id":"tabletest-formatter-8mq","type":"blocks","created_at":"2025-12-27T13:28:14.471243+01:00","created_by":"daemon"}]}
{"id":"tabletest-formatter-tod","title":"Handle indentation for embedded tables","description":"Preserve and apply proper indentation when formatting tables embedded in Java/Kotlin files.\n\n## Desired Behaviour (to be implemented after CLI/Spotless runners exist)\n\n### Indentation Rules\n- Table content should be **one indent level deeper** than the `@TableTest` annotation\n- Applies to both Java and Kotlin source files\n- Last table row should end with newline\n- Add sufficient trailing spaces to align closing quotes properly with table content\n\n### Java Text Blocks\n```java\n    @TableTest(\"\"\"\n        name  | age      // one indent from annotation (4 or 2 spaces depending on project)\n        Alice | 30\n        Bob   | 25\n        \"\"\")             // closing quotes aligned with table\n```\n\n### Kotlin Raw Strings\n```kotlin\n    @TableTest(\n        \"\"\"\n        name  | age      // one indent from annotation\n        Alice | 30\n        Bob   | 25\n        \"\"\"              // closing quotes aligned with table\n    )\n```\n\n### Context-Awareness Required\n- **CLI mode**: Receives whole .java/.kt file, needs to:\n  - Detect `@TableTest` annotation position\n  - Determine project's indentation standard (2 or 4 spaces)\n  - Handle Java text block vs Kotlin raw string semantics\n  - Position table one indent deeper than annotation\n  - Align closing quotes with table content\n\n- **Spotless mode**: Unknown how Spotless passes content - investigate first\n\n## Implementation Order\n1. Implement CLI runner (see beads issues for CLI)\n2. Implement Spotless runner (see beads issues for Spotless)\n3. Understand what each runner receives as input\n4. Return to implement this indentation handling with full context\n\n## Open Questions\n- Does Spotless pass whole file or extracted string content?\n- How to detect project indentation standard (2 vs 4 spaces)?\n- Should we handle `.trimIndent()` in Kotlin?\n- How to handle mixed indentation styles in same file?","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-27T13:27:50.676026+01:00","created_by":"nch","updated_at":"2025-12-29T14:41:05.307558+01:00","dependencies":[{"issue_id":"tabletest-formatter-tod","depends_on_id":"tabletest-formatter-sy0","type":"blocks","created_at":"2025-12-27T13:28:15.455523+01:00","created_by":"daemon"},{"issue_id":"tabletest-formatter-tod","depends_on_id":"tabletest-formatter-8mq","type":"blocks","created_at":"2025-12-27T14:05:40.05242+01:00","created_by":"daemon"}]}
{"id":"tabletest-formatter-yv2","title":"Normalize spacing in maps","description":"Format map literals to have space after colons and commas: [a:1,b:2] → [a: 1, b: 2].","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-27T13:27:48.514455+01:00","created_by":"nch","updated_at":"2025-12-27T20:36:45.920139+01:00","closed_at":"2025-12-27T20:36:45.920139+01:00","close_reason":"Closed","dependencies":[{"issue_id":"tabletest-formatter-yv2","depends_on_id":"tabletest-formatter-sy0","type":"blocks","created_at":"2025-12-27T13:28:14.710708+01:00","created_by":"daemon"}]}
{"id":"tabletest-formatter-zno","title":"Normalize spacing in lists","description":"Format list literals to have space after commas: [1,2,3] → [1, 2, 3]. Remove extra spaces inside brackets: [ [] ] → [[]].","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-27T13:27:48.164153+01:00","created_by":"nch","updated_at":"2025-12-27T20:12:07.199031+01:00","closed_at":"2025-12-27T20:12:07.199031+01:00","close_reason":"List formatting works automatically via Java List.toString(). Parser returns List objects which format correctly with spaces after commas and proper nesting. Added comprehensive tests.","dependencies":[{"issue_id":"tabletest-formatter-zno","depends_on_id":"tabletest-formatter-sy0","type":"blocks","created_at":"2025-12-27T13:28:14.647665+01:00","created_by":"daemon"}]}
