{"id":"tabletest-formatter-4eb","title":"Add advanced integration tests with Maven/Gradle","description":"Add comprehensive integration tests using maven-invoker-plugin or gradle-testkit.\n\n## Current State\n\nBasic integration tests (issue a4g) provide manual verification with sample projects.\n\n## Enhancement: Automated Integration Tests\n\n### Maven Integration Tests\nUse maven-invoker-plugin to:\n- Create test projects with pom.xml\n- Run Spotless formatting via Maven\n- Verify output matches expected formatting\n- Test multiple scenarios (Java, Kotlin, .table files)\n\n### Gradle Integration Tests\nUse gradle-testkit to:\n- Create test projects with build.gradle\n- Run Spotless formatting via Gradle\n- Verify output matches expected formatting\n- Test both Groovy and Kotlin DSL configurations\n\n## Test Scenarios\n\n1. **Basic formatting:**\n   - Single Java file with @TableTest\n   - Single Kotlin file with @TableTest\n   - Standalone .table file\n\n2. **Complex scenarios:**\n   - Multiple tables in one file\n   - Mixed Java and Kotlin files\n   - Large projects with many tables\n   - Already-formatted files (no changes)\n\n3. **Error handling:**\n   - Malformed tables\n   - Invalid @TableTest syntax\n   - File encoding issues\n\n4. **Performance:**\n   - Large files with many tables\n   - Parallel processing\n\n## Implementation\n\n### Maven Invoker Tests\n- Location: `tabletest-formatter-spotless/src/it/`\n- Structure:\n  ```\n  src/it/\n    java-formatting/\n      pom.xml\n      src/test/java/SampleTest.java\n      expected/SampleTest.java\n    kotlin-formatting/\n      pom.xml\n      src/test/kotlin/SampleTest.kt\n      expected/SampleTest.kt\n  ```\n\n### Gradle TestKit\n- Location: `tabletest-formatter-spotless/src/integrationTest/`\n- Use Gradle TestKit API\n- Create temporary projects programmatically\n- Run formatting and verify results\n\n## Benefits\n\n- Catches regression bugs\n- Validates real-world usage\n- Tests plugin integration\n- Provides confidence for releases\n\n## Priority\n\nP4 (backlog) - valuable but not critical for initial release. Basic integration tests (a4g) sufficient initially.","status":"open","priority":4,"issue_type":"feature","created_at":"2025-12-29T16:07:13.203118+01:00","created_by":"nch","updated_at":"2025-12-29T16:07:13.203118+01:00"}
{"id":"tabletest-formatter-5or","title":"Upgrade to parser-based @TableTest extraction","description":"Upgrade from regex-based to parser-based @TableTest extraction for robustness.\n\n## Current Limitation\n\nRegex approach has known limitations:\n- May fail on complex nesting\n- Won't handle multiple parameters: `@TableTest(value = \"\"\"...\"\"\", description = \"...\")`\n- Won't distinguish between @TableTest in comments vs actual code\n- Edge cases with string escaping\n\n## Proposed Solution\n\n### Option A: JavaParser + Kotlin Parser\n**Java:** Use JavaParser library to parse AST and find @TableTest annotations\n**Kotlin:** Use kotlinx.ast or Kotlin compiler APIs\n\n**Pros:**\n- Robust - handles all edge cases correctly\n- Can extract exact string literal content\n- Understands language semantics (comments, nesting, etc.)\n\n**Cons:**\n- Additional dependencies\n- More complex implementation\n- Slower performance\n\n### Option B: Leverage Spotless/IDE Parsing\n- Investigate if Spotless already parses Java/Kotlin\n- Hook into existing parsing infrastructure\n- May not be available\n\n## Implementation Strategy\n\n1. Keep existing regex approach as fallback\n2. Add parser-based extraction as primary method\n3. Fall back to regex if parser fails\n4. Comprehensive tests for edge cases\n\n## When to Implement\n\nOnly if regex proves insufficient in real-world usage. Most projects have simple @TableTest usage that regex handles fine.\n\n## Files to Modify\n\n- `TableTestExtractor.java` - add parser-based methods\n- `pom.xml` - add JavaParser/Kotlin parser dependencies\n- Tests - add edge case coverage","status":"open","priority":4,"issue_type":"feature","created_at":"2025-12-29T16:06:42.383274+01:00","created_by":"nch","updated_at":"2025-12-29T16:06:42.383274+01:00"}
{"id":"tabletest-formatter-6n1","title":"Add configuration options for formatting","description":"Add configuration options to customize formatting behavior.\n\n## Potential Configuration Options\n\n### Indentation\n- Indent size (2 vs 4 spaces)\n- Tab vs space indentation\n- Auto-detect from project or explicit configuration\n\n### Spacing\n- Pipe spacing style: ` | ` (current) vs `|` (no spaces)\n- Collection spacing: `, ` vs `,`\n- Configurable via Spotless plugin configuration\n\n### Quote Style\n- Preserve original (current default)\n- Normalize to single quotes\n- Normalize to double quotes\n\n### Column Alignment\n- Align all columns (current)\n- Only align first N columns\n- Minimum column width\n\n## Implementation Approach\n\n### For Spotless\n```xml\n\u003cplugin\u003e\n  \u003cgroupId\u003ecom.diffplug.spotless\u003c/groupId\u003e\n  \u003cartifactId\u003espotless-maven-plugin\u003c/artifactId\u003e\n  \u003cconfiguration\u003e\n    \u003cjava\u003e\n      \u003ctabletest\u003e\n        \u003cindentSize\u003e4\u003c/indentSize\u003e\n        \u003cpipeSpacing\u003etrue\u003c/pipeSpacing\u003e\n        \u003cquoteStyle\u003epreserve\u003c/quoteStyle\u003e\n      \u003c/tabletest\u003e\n    \u003c/java\u003e\n  \u003c/configuration\u003e\n\u003c/plugin\u003e\n```\n\n### For CLI\n```bash\ntabletest-formatter --indent-size=4 --pipe-spacing=true src/\n```\n\n## Files to Modify\n\n- `TableTestFormatterState.java` - hold configuration\n- `TableTestFormatter.java` - accept configuration parameter\n- `TableTestFormatterStep.java` - parse configuration from Spotless\n- CLI main class - parse command-line options\n- Tests for each configuration option\n\n## When to Implement\n\nAfter basic formatting is working and users request customization. Start with sensible defaults.\n\n## Priority\n\nP4 (backlog) - nice to have, not critical for initial release","status":"open","priority":4,"issue_type":"feature","created_at":"2025-12-29T16:06:54.853899+01:00","created_by":"nch","updated_at":"2025-12-29T16:06:54.853899+01:00"}
{"id":"tabletest-formatter-7xb","title":"Upgrade tabletest-parser to next published version","description":"Currently using 0.5.9-SNAPSHOT from Maven local. Upgrade to official release when tabletest-parser 0.5.9 is published to Maven Central.","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-29T13:47:51.746497+01:00","created_by":"nch","updated_at":"2025-12-29T13:47:51.746497+01:00"}
{"id":"tabletest-formatter-8mq","title":"Calculate column widths based on cell content","description":"Implement logic to calculate the maximum width needed for each column, considering all cells in that column. Must handle unicode characters and emojis correctly.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-27T13:27:47.608266+01:00","created_by":"nch","updated_at":"2025-12-27T14:17:38.273997+01:00","closed_at":"2025-12-27T14:17:38.273997+01:00","close_reason":"Closed","dependencies":[{"issue_id":"tabletest-formatter-8mq","depends_on_id":"tabletest-formatter-h79","type":"blocks","created_at":"2025-12-27T13:28:14.28945+01:00","created_by":"daemon"}]}
{"id":"tabletest-formatter-9jl","title":"Preserve comments and blank lines","description":"Ensure comment lines (starting with //) and blank lines are preserved exactly as-is, including their indentation.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-27T13:27:49.582096+01:00","created_by":"nch","updated_at":"2025-12-27T22:12:05.491396+01:00","closed_at":"2025-12-27T22:12:05.491396+01:00","close_reason":"Closed","dependencies":[{"issue_id":"tabletest-formatter-9jl","depends_on_id":"tabletest-formatter-sy0","type":"blocks","created_at":"2025-12-27T13:28:15.266889+01:00","created_by":"daemon"}]}
{"id":"tabletest-formatter-9st","title":"Preserve original quote choices","description":"Keep user's original quote style choices: '1' stays '1', \"2\" stays \"2\". Don't change quotes unless necessary for correctness.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-27T13:27:50.311815+01:00","created_by":"nch","updated_at":"2025-12-29T13:45:40.033001+01:00","closed_at":"2025-12-29T13:45:40.033001+01:00","close_reason":"Closed","dependencies":[{"issue_id":"tabletest-formatter-9st","depends_on_id":"tabletest-formatter-sy0","type":"blocks","created_at":"2025-12-27T13:28:15.392141+01:00","created_by":"daemon"}]}
{"id":"tabletest-formatter-9wy","title":"Implement Spotless integration with integration tests","description":"Implement Spotless FormatterStep in tabletest-formatter-spotless module.\n\n## Research Complete ✓\n\n**Key Finding:** Spotless passes **entire file content** to FormatterStep as String with Unix newlines, NOT extracted content.\n\n**FormatterStep API:**\n- Receives: `format(String rawUnix, File file)`\n- Returns: formatted String or null if unchanged\n- Pattern: Factory method with State + Func classes\n- State must be Serializable\n\n## Core Features\n\n- Create FormatterStep that wraps core formatting logic (issue okk)\n- Integrate with Spotless plugin lifecycle\n- Handle both Java/Kotlin file content and .table files\n- Integration tests to verify Spotless integration works (issue a4g)\n\n## Implementation Structure\n\n### Issue Breakdown\n\n1. **ep8:** Shared extraction utilities (TableTestExtractor + TableMatch)\n   - Core module, shared with CLI\n   - Regex-based @TableTest finding\n   \n2. **okk:** Spotless FormatterStep wrapper (this issue's implementation)\n   - TableTestFormatterStep (factory)\n   - TableTestFormatterState (serializable state)\n   - TableTestFormatterFunc (formatting logic)\n\n3. **a4g:** Integration tests\n   - Manual verification with sample projects\n   - Validates end-to-end Spotless integration\n\n## Finding Table Strings - Decision Made\n\n**Approach:** Regex pattern matching via TableTestExtractor (issue ep8)\n\nSpotless passes whole file content, so we must find @TableTest annotations ourselves.\n\n**Pattern:** `@TableTest\\s*\\(\\s*\"\"\"(.*?)\"\"\"\\s*\\)` with Pattern.DOTALL\n\n**Rationale:**\n- Simple, no parser dependencies\n- Fast for common cases\n- Covers 90% of real-world usage (single @TableTest per method)\n- Can upgrade to parser later (issue 5or) if edge cases emerge\n\n**Shared with CLI:** Both CLI and Spotless use same TableTestExtractor from core module.\n\n## File Type Handling\n\n### Standalone .table Files\n- Format entire file as single table\n- No indentation needed\n- Direct: `TableTestFormatter.format(content)`\n\n### Java/Kotlin Files\n- Extract @TableTest annotations using TableTestExtractor\n- Format each table content\n- Replace in original file\n- **Indentation:** Keep existing as-is initially, proper handling in issue tod\n\n## Indentation Requirements\n\n**Critical:** Table content should be **one indent level deeper** than @TableTest annotation.\n\nSee **issue tod** for detailed specifications:\n- Java text block handling\n- Kotlin raw string handling\n- Quote alignment rules\n- Trailing newline requirements\n\n**Phase 1 (This Issue):** Keep existing indentation, defer proper detection to tod\n**Phase 2 (Issue tod):** Implement indentation detection and application\n\n## Implementation Phases\n\n**Phase 1 - Basic Formatting:**\n- Issue ep8: TableTestExtractor + TableMatch\n- Issue okk: Spotless FormatterStep wrapper\n- Format .table files ✓\n- Format tables in Java/Kotlin (basic) ✓\n- No proper indentation yet (defer to tod)\n\n**Phase 2 - Indentation:**\n- Issue tod: Detect and apply proper indentation\n\n**Phase 3 - Future Enhancements:**\n- Issue 5or: Parser-based extraction (if needed)\n- Issue 6n1: Configuration options\n- Issue 4eb: Advanced integration tests\n\n## Dependencies\n\n- **Blocked by:** \n  - okk (Spotless wrapper implementation)\n  - Indirectly: ep8 (okk depends on ep8)\n\n## Related Issues\n\n- py5 (CLI) - uses same TableTestExtractor\n- tod (indentation) - deferred until basic formatting works","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-27T12:51:12.937158+01:00","created_by":"nch","updated_at":"2025-12-29T16:08:08.954065+01:00","labels":["feature"],"dependencies":[{"issue_id":"tabletest-formatter-9wy","depends_on_id":"tabletest-formatter-py5","type":"blocks","created_at":"2025-12-27T12:51:30.803009+01:00","created_by":"daemon"},{"issue_id":"tabletest-formatter-9wy","depends_on_id":"tabletest-formatter-okk","type":"blocks","created_at":"2025-12-29T16:07:23.911411+01:00","created_by":"daemon"}]}
{"id":"tabletest-formatter-a4g","title":"Add Spotless integration tests","description":"Add integration tests to verify Spotless FormatterStep works end-to-end with real projects.\n\n## Approach\n\nCreate sample test project in `src/test/resources/integration-test-project/`:\n- pom.xml (or build.gradle)\n- Sample Java test file with @TableTest annotations\n- Sample Kotlin test file with @TableTest annotations\n- Sample .table files\n\n## Test Scenarios\n\n1. **Manual verification:**\n   - Run Spotless on sample project\n   - Verify tables are formatted correctly\n   - Verify file structure preserved\n   - Verify multiple tables in one file handled\n\n2. **Automated tests (optional):**\n   - Could use maven-invoker-plugin for Maven integration\n   - Or gradle-testkit for Gradle integration\n   - Verify Spotless applies formatting correctly\n\n## Success Criteria\n\n✅ Sample project formats correctly with Spotless\n✅ .table files formatted\n✅ Java @TableTest annotations formatted\n✅ Kotlin @TableTest annotations formatted\n✅ Already-formatted files show no changes\n✅ Documentation updated with usage examples\n\n## Notes\n\n- Priority P3 since this validates existing functionality\n- Can be done after basic implementation works\n- Helps validate real-world usage\n- Provides examples for documentation","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-29T16:06:16.135509+01:00","created_by":"nch","updated_at":"2025-12-29T16:06:16.135509+01:00","dependencies":[{"issue_id":"tabletest-formatter-a4g","depends_on_id":"tabletest-formatter-okk","type":"blocks","created_at":"2025-12-29T16:07:23.948432+01:00","created_by":"daemon"}]}
{"id":"tabletest-formatter-bm3","title":"Handle nested collections with recursive formatting","description":"Apply spacing rules recursively to nested collections: [a:[1,2],b:[3,4]] → [a: [1, 2], b: [3, 4]]. Handle multiple levels of nesting.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-27T13:27:49.221294+01:00","created_by":"nch","updated_at":"2025-12-27T20:39:18.954855+01:00","closed_at":"2025-12-27T20:39:18.954855+01:00","close_reason":"Recursive formatting already implemented. All format methods call formatCell() recursively, handling arbitrary nesting depth.","dependencies":[{"issue_id":"tabletest-formatter-bm3","depends_on_id":"tabletest-formatter-zno","type":"blocks","created_at":"2025-12-27T13:28:14.957499+01:00","created_by":"daemon"},{"issue_id":"tabletest-formatter-bm3","depends_on_id":"tabletest-formatter-yv2","type":"blocks","created_at":"2025-12-27T13:28:15.020867+01:00","created_by":"daemon"},{"issue_id":"tabletest-formatter-bm3","depends_on_id":"tabletest-formatter-bxi","type":"blocks","created_at":"2025-12-27T13:28:15.084335+01:00","created_by":"daemon"}]}
{"id":"tabletest-formatter-bn7","title":"Implement core TableTest formatter with unit test coverage","description":"Implement the core formatting logic in tabletest-formatter-core module. Parse TableTest tables using tabletest-parser and apply formatting rules. This will be implemented in small, test-driven steps with unit test coverage for each step. The formatter should handle tables in Java files, Kotlin files, and standalone .table files.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-27T12:51:12.490601+01:00","created_by":"nch","updated_at":"2025-12-29T14:42:25.499541+01:00","closed_at":"2025-12-29T14:42:25.499541+01:00","close_reason":"Core formatter implementation complete. All dependencies closed. Indentation handling (tod) postponed until CLI/Spotless runners are implemented.","labels":["feature"],"dependencies":[{"issue_id":"tabletest-formatter-bn7","depends_on_id":"tabletest-formatter-h79","type":"blocks","created_at":"2025-12-27T13:28:00.137977+01:00","created_by":"daemon"},{"issue_id":"tabletest-formatter-bn7","depends_on_id":"tabletest-formatter-8mq","type":"blocks","created_at":"2025-12-27T13:28:00.201139+01:00","created_by":"daemon"},{"issue_id":"tabletest-formatter-bn7","depends_on_id":"tabletest-formatter-sy0","type":"blocks","created_at":"2025-12-27T13:28:00.264537+01:00","created_by":"daemon"},{"issue_id":"tabletest-formatter-bn7","depends_on_id":"tabletest-formatter-zno","type":"blocks","created_at":"2025-12-27T13:28:00.328346+01:00","created_by":"daemon"},{"issue_id":"tabletest-formatter-bn7","depends_on_id":"tabletest-formatter-yv2","type":"blocks","created_at":"2025-12-27T13:28:00.391459+01:00","created_by":"daemon"},{"issue_id":"tabletest-formatter-bn7","depends_on_id":"tabletest-formatter-bxi","type":"blocks","created_at":"2025-12-27T13:28:00.453951+01:00","created_by":"daemon"},{"issue_id":"tabletest-formatter-bn7","depends_on_id":"tabletest-formatter-bm3","type":"blocks","created_at":"2025-12-27T13:28:00.516393+01:00","created_by":"daemon"},{"issue_id":"tabletest-formatter-bn7","depends_on_id":"tabletest-formatter-9jl","type":"blocks","created_at":"2025-12-27T13:28:00.578409+01:00","created_by":"daemon"},{"issue_id":"tabletest-formatter-bn7","depends_on_id":"tabletest-formatter-lc4","type":"blocks","created_at":"2025-12-27T13:28:00.639155+01:00","created_by":"daemon"},{"issue_id":"tabletest-formatter-bn7","depends_on_id":"tabletest-formatter-9st","type":"blocks","created_at":"2025-12-27T13:28:00.700207+01:00","created_by":"daemon"}]}
{"id":"tabletest-formatter-bxi","title":"Normalize spacing in sets","description":"Format set literals to have space after commas: {1,2,3} → {1, 2, 3}. Remove extra spaces inside braces: { [ ] } → {[]}.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-27T13:27:48.871396+01:00","created_by":"nch","updated_at":"2025-12-27T20:36:45.924135+01:00","closed_at":"2025-12-27T20:36:45.924135+01:00","close_reason":"Closed","dependencies":[{"issue_id":"tabletest-formatter-bxi","depends_on_id":"tabletest-formatter-sy0","type":"blocks","created_at":"2025-12-27T13:28:14.774814+01:00","created_by":"daemon"}]}
{"id":"tabletest-formatter-ep8","title":"Create shared TableTest extraction utilities","description":"Create shared utilities in core module for finding @TableTest annotations in Java/Kotlin source files.\n\n## Components to Create\n\n### TableTestExtractor.java\n- Static method: `List\u003cTableMatch\u003e findAll(String sourceCode)`\n- Regex-based pattern matching for `@TableTest(\"\"\"...\"\"\")`\n- Pattern: `@TableTest\\s*\\(\\s*\"\"\"(.*?)\"\"\"\\s*\\)` with Pattern.DOTALL\n- Returns list of all matches with position info\n\n### TableMatch.java\n- Immutable value object (Java record)\n- Fields:\n  - `String originalText` - raw table text as found\n  - `int startIndex` - position in source file\n  - `int endIndex` - end position in source file\n\n## Implementation Approach\n\n**TDD - Tests First:**\n- shouldExtractSingleTableFromJavaFile()\n- shouldExtractMultipleTablesFromOneFile()\n- shouldHandleNoTables()\n- shouldExtractFromKotlinFile()\n- shouldIgnoreTableTestInComments()\n\n**Regex Pattern:**\nCovers 90% of real cases (single @TableTest per method). Can upgrade to parser-based approach later if edge cases emerge.\n\n**Known Limitations (Acceptable):**\n- May fail on complex nesting\n- Won't handle multiple parameters: `@TableTest(value = \"\"\"...\"\"\", description = \"...\")`\n- Won't distinguish between @TableTest in comments vs actual code\n\n## Why Shared in Core?\n\nBoth CLI (py5) and Spotless (9wy) need identical extraction logic. Single source of truth avoids duplication.\n\n## Files\n\n- `tabletest-formatter-core/src/main/java/io/github/nchaugen/tabletest/formatter/core/TableTestExtractor.java`\n- `tabletest-formatter-core/src/main/java/io/github/nchaugen/tabletest/formatter/core/TableMatch.java`\n- `tabletest-formatter-core/src/test/java/io/github/nchaugen/tabletest/formatter/core/TableTestExtractorTest.java`","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-29T16:05:51.544631+01:00","created_by":"nch","updated_at":"2025-12-29T16:36:05.255003+01:00","closed_at":"2025-12-29T16:36:05.255003+01:00","close_reason":"Closed"}
{"id":"tabletest-formatter-h79","title":"Parse simple table and rebuild without formatting","description":"Establish round-trip capability: parse a simple 2x2 table using tabletest-parser and rebuild it as a string without any formatting changes. This validates we can correctly handle the parse → rebuild cycle.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-27T13:27:47.372944+01:00","created_by":"nch","updated_at":"2025-12-27T13:57:58.827597+01:00","closed_at":"2025-12-27T13:57:58.827597+01:00","close_reason":"Closed"}
{"id":"tabletest-formatter-kv9","title":"Handle Unicode and emoji width calculation correctly","description":"Implement proper display width calculation for Unicode characters and emojis. CJK characters should count as width 2, emojis should be handled correctly, and combining characters as width 0. Currently using simple String.length() which works for ASCII but not for international text.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-27T14:05:39.875983+01:00","created_by":"nch","updated_at":"2025-12-27T19:50:18.433946+01:00","closed_at":"2025-12-27T19:50:18.433946+01:00","close_reason":"Closed"}
{"id":"tabletest-formatter-lc4","title":"Handle empty cells with proper padding","description":"Format empty cells (||) by padding with spaces to maintain column alignment.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-27T13:27:49.945241+01:00","created_by":"nch","updated_at":"2025-12-27T21:08:11.06156+01:00","closed_at":"2025-12-27T21:08:11.06156+01:00","close_reason":"Empty cells handled correctly. Refactored row formatting to eliminate trailing spaces for empty last columns using pre-padded leading spaces with joining('|').","dependencies":[{"issue_id":"tabletest-formatter-lc4","depends_on_id":"tabletest-formatter-sy0","type":"blocks","created_at":"2025-12-27T13:28:15.329321+01:00","created_by":"daemon"}]}
{"id":"tabletest-formatter-okk","title":"Implement Spotless FormatterStep wrapper","description":"Implement Spotless FormatterStep integration that wraps TableTestFormatter.\n\n## Components to Create\n\n### TableTestFormatterStep.java\n- Factory class following Spotless ReplaceStep pattern\n- Static factory method: `FormatterStep create(String name)`\n- Uses `FormatterStep.createLazy()` or `FormatterStep.create()`\n- Returns configured FormatterStep instance\n\n### TableTestFormatterState.java\n- Implements `Serializable` with `serialVersionUID = 1L`\n- Immutable with final fields\n- May be empty initially (no configuration yet)\n- Holds any configuration for future extensibility\n\n### TableTestFormatterFunc.java\n- Main formatting orchestration logic\n- Implements `FormatterFunc`\n- Method signature: `String apply(String rawUnix, File file)`\n\n**Logic Flow:**\n```\nif file.endsWith(\".table\")\n  → TableTestFormatter.format(rawUnix)\nelse if file.endsWith(\".java\") || file.endsWith(\".kt\")\n  → TableTestExtractor.findAll(rawUnix)\n  → for each match: TableTestFormatter.format(match.originalText)\n  → replace in rawUnix\n  → return modified content (or null if unchanged)\nelse\n  → return rawUnix (unchanged)\n```\n\n## File Type Handling\n\n**Standalone .table files:**\n- Format entire file as single table\n- Direct call: `TableTestFormatter.format(content)`\n\n**Java/Kotlin files:**\n- Extract @TableTest annotations using TableTestExtractor\n- Format each table content\n- Replace in original file\n- Keep existing indentation as-is (proper indentation deferred to issue tod)\n\n## Tests (TDD)\n\n**TableTestFormatterStepTest:**\n- shouldCreateValidFormatterStep()\n\n**TableTestFormatterFuncTest:**\n- shouldFormatStandaloneTableFile()\n- shouldFormatTableInJavaFile()\n- shouldFormatTableInKotlinFile()\n- shouldHandleMultipleTablesInOneFile()\n- shouldReturnNullWhenNoChangesNeeded()\n- shouldIgnoreNonTableTestFiles()\n\n## Files\n\n- `tabletest-formatter-spotless/src/main/java/io/github/nchaugen/tabletest/formatter/spotless/TableTestFormatterStep.java`\n- `tabletest-formatter-spotless/src/main/java/io/github/nchaugen/tabletest/formatter/spotless/TableTestFormatterState.java`\n- `tabletest-formatter-spotless/src/main/java/io/github/nchaugen/tabletest/formatter/spotless/TableTestFormatterFunc.java`\n- `tabletest-formatter-spotless/src/test/java/io/github/nchaugen/tabletest/formatter/spotless/TableTestFormatterStepTest.java`\n- `tabletest-formatter-spotless/src/test/java/io/github/nchaugen/tabletest/formatter/spotless/TableTestFormatterFuncTest.java`","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-29T16:06:06.22974+01:00","created_by":"nch","updated_at":"2025-12-29T16:06:06.22974+01:00","dependencies":[{"issue_id":"tabletest-formatter-okk","depends_on_id":"tabletest-formatter-ep8","type":"blocks","created_at":"2025-12-29T16:07:23.873962+01:00","created_by":"daemon"}]}
{"id":"tabletest-formatter-py5","title":"Implement CLI runner with integration tests","description":"Implement command-line interface in tabletest-formatter-cli module using picocli. \n\n## Core Features\n- File discovery (Java/Kotlin/.table files)\n- Format checking mode (exit code for CI)\n- Format apply mode (write changes)\n- Integration tests to ensure CLI works end-to-end\n\n## Research Findings\n\n**Confirmed:** CLI receives **whole .java/.kt files** (not just table content).\n\n**Solution:** Use shared TableTestExtractor (issue ep8) for finding @TableTest annotations.\n\n## Input Processing\n\nThe formatter must:\n1. Locate @TableTest annotations using TableTestExtractor (from core module)\n2. Extract the table content via TableMatch objects\n3. Format each table with TableTestFormatter\n4. Handle indentation correctly (see issue tod)\n5. Replace the original table with formatted version\n6. Write back the entire file\n\nFor standalone .table files: format the entire file as a single table (no indentation needed).\n\n## Finding Table Strings - Decision Made\n\n**Approach:** Regex pattern matching (issue ep8)\n\nUses pattern: `@TableTest\\s*\\(\\s*\"\"\"(.*?)\"\"\"\\s*\\)` with Pattern.DOTALL\n\n**Rationale:**\n- Simple, no external dependencies\n- Fast for straightforward cases\n- Covers 90% of real-world usage\n- Can upgrade to parser-based extraction later (issue 5or) if needed\n\n**Known Limitations (Acceptable):**\n- May fail on complex nesting or comments with @TableTest\n- Won't handle multiple parameters: `@TableTest(value = \"\"\"...\"\"\", description = \"...\")`\n- Can address with parser-based approach if needed\n\n## Shared Code Strategy\n\n**TableTestExtractor** lives in tabletest-formatter-core module (issue ep8):\n- Both CLI and Spotless use same extraction logic\n- Single source of truth\n- Easy to upgrade regex → parser in one place\n\n## Indentation Requirements\n\n**Critical:** Table content must be positioned **one indent level deeper** than the @TableTest annotation.\n\nSee **issue tod** for detailed indentation specifications including:\n- Java text block handling\n- Kotlin raw string handling  \n- Quote alignment rules\n- Trailing newline requirements\n\nThe CLI implementation must detect:\n- Location of @TableTest annotation\n- Project indentation standard (2 or 4 spaces)\n- Opening quote position (same line vs new line)\n- Apply appropriate indentation to formatted output\n\n## Implementation Priority\n\n1. ~~Basic CLI structure (file discovery, read/write)~~ → Depends on ep8\n2. ~~Format checking mode (compare, exit code)~~ → Depends on ep8\n3. ~~Format apply mode (write changes)~~ → Depends on ep8\n4. **Use TableTestExtractor** from core module (depends on issue ep8)\n5. Indentation handling for Java/Kotlin files (depends on issue tod)\n6. Integration tests\n\n## Dependencies\n\n- **Blocks:** None\n- **Blocked by:** ep8 (shared extraction utilities)","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-27T12:51:12.719429+01:00","created_by":"nch","updated_at":"2025-12-29T16:07:47.192319+01:00","labels":["feature"],"dependencies":[{"issue_id":"tabletest-formatter-py5","depends_on_id":"tabletest-formatter-bn7","type":"blocks","created_at":"2025-12-27T12:51:30.732046+01:00","created_by":"daemon"},{"issue_id":"tabletest-formatter-py5","depends_on_id":"tabletest-formatter-ep8","type":"blocks","created_at":"2025-12-29T16:07:23.83752+01:00","created_by":"daemon"}]}
{"id":"tabletest-formatter-sy0","title":"Apply column alignment with proper padding","description":"Use calculated column widths to pad cells with spaces, ensuring all pipes align vertically. Add space padding around pipes: ' | '.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-27T13:27:47.837465+01:00","created_by":"nch","updated_at":"2025-12-27T20:02:19.2405+01:00","closed_at":"2025-12-27T20:02:19.2405+01:00","close_reason":"Closed","dependencies":[{"issue_id":"tabletest-formatter-sy0","depends_on_id":"tabletest-formatter-8mq","type":"blocks","created_at":"2025-12-27T13:28:14.471243+01:00","created_by":"daemon"}]}
{"id":"tabletest-formatter-tod","title":"Handle indentation for embedded tables","description":"Preserve and apply proper indentation when formatting tables embedded in Java/Kotlin files.\n\n## Desired Behaviour (to be implemented after CLI/Spotless runners exist)\n\n### Indentation Rules\n- Table content should be **one indent level deeper** than the `@TableTest` annotation\n- Applies to both Java and Kotlin source files\n- Last table row should end with newline\n- Add sufficient trailing spaces to align closing quotes properly with table content\n\n### Java Text Blocks\n```java\n    @TableTest(\"\"\"\n        name  | age      // one indent from annotation (4 or 2 spaces depending on project)\n        Alice | 30\n        Bob   | 25\n        \"\"\")             // closing quotes aligned with table\n```\n\n### Kotlin Raw Strings\n```kotlin\n    @TableTest(\n        \"\"\"\n        name  | age      // one indent from annotation\n        Alice | 30\n        Bob   | 25\n        \"\"\"              // closing quotes aligned with table\n    )\n```\n\n### Context-Awareness Required\n- **CLI mode**: Receives whole .java/.kt file, needs to:\n  - Detect `@TableTest` annotation position\n  - Determine project's indentation standard (2 or 4 spaces)\n  - Handle Java text block vs Kotlin raw string semantics\n  - Position table one indent deeper than annotation\n  - Align closing quotes with table content\n\n- **Spotless mode**: Unknown how Spotless passes content - investigate first\n\n## Implementation Order\n1. Implement CLI runner (see beads issues for CLI)\n2. Implement Spotless runner (see beads issues for Spotless)\n3. Understand what each runner receives as input\n4. Return to implement this indentation handling with full context\n\n## Open Questions\n- Does Spotless pass whole file or extracted string content?\n- How to detect project indentation standard (2 vs 4 spaces)?\n- Should we handle `.trimIndent()` in Kotlin?\n- How to handle mixed indentation styles in same file?","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-27T13:27:50.676026+01:00","created_by":"nch","updated_at":"2025-12-29T14:41:05.307558+01:00","dependencies":[{"issue_id":"tabletest-formatter-tod","depends_on_id":"tabletest-formatter-sy0","type":"blocks","created_at":"2025-12-27T13:28:15.455523+01:00","created_by":"daemon"},{"issue_id":"tabletest-formatter-tod","depends_on_id":"tabletest-formatter-8mq","type":"blocks","created_at":"2025-12-27T14:05:40.05242+01:00","created_by":"daemon"}]}
{"id":"tabletest-formatter-yv2","title":"Normalize spacing in maps","description":"Format map literals to have space after colons and commas: [a:1,b:2] → [a: 1, b: 2].","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-27T13:27:48.514455+01:00","created_by":"nch","updated_at":"2025-12-27T20:36:45.920139+01:00","closed_at":"2025-12-27T20:36:45.920139+01:00","close_reason":"Closed","dependencies":[{"issue_id":"tabletest-formatter-yv2","depends_on_id":"tabletest-formatter-sy0","type":"blocks","created_at":"2025-12-27T13:28:14.710708+01:00","created_by":"daemon"}]}
{"id":"tabletest-formatter-zno","title":"Normalize spacing in lists","description":"Format list literals to have space after commas: [1,2,3] → [1, 2, 3]. Remove extra spaces inside brackets: [ [] ] → [[]].","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-27T13:27:48.164153+01:00","created_by":"nch","updated_at":"2025-12-27T20:12:07.199031+01:00","closed_at":"2025-12-27T20:12:07.199031+01:00","close_reason":"List formatting works automatically via Java List.toString(). Parser returns List objects which format correctly with spaces after commas and proper nesting. Added comprehensive tests.","dependencies":[{"issue_id":"tabletest-formatter-zno","depends_on_id":"tabletest-formatter-sy0","type":"blocks","created_at":"2025-12-27T13:28:14.647665+01:00","created_by":"daemon"}]}
